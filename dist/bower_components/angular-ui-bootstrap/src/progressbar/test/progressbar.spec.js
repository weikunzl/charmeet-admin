describe("progressbar directive",function(){function e(e){return s.children().eq(e)}var t,a,s;beforeEach(module("ui.bootstrap.progressbar")),beforeEach(module("uib/template/progressbar/progressbar.html","uib/template/progressbar/progress.html","uib/template/progressbar/bar.html")),beforeEach(inject(function(e,i){a=e,t=i,t.value=22,s=a('<uib-progressbar animate="false" value="value" title="foo">{{value}} %</uib-progressbar>')(t),t.$digest()}));var i="progress-bar";it('has a "progress" css class',function(){expect(s).toHaveClass("progress")}),it('contains one child element with "bar" css class',function(){expect(s.children().length).toBe(1),expect(e(0)).toHaveClass(i)}),it('has a "bar" element with expected width',function(){expect(e(0).css("width")).toBe("22%")}),it("has the appropriate aria markup",function(){var t=e(0);expect(t.attr("role")).toBe("progressbar"),expect(t.attr("aria-valuemin")).toBe("0"),expect(t.attr("aria-valuemax")).toBe("100"),expect(t.attr("aria-valuenow")).toBe("22"),expect(t.attr("aria-valuetext")).toBe("22%"),expect(t.attr("aria-labelledby")).toBe("foo")}),it("has the default aria-labelledby value of `progressbar`",function(){s=a('<uib-progressbar animate="false" value="value">{{value}} %</uib-progressbar>')(t),t.$digest();var i=e(0);expect(i.attr("aria-labelledby")).toBe("progressbar")}),it('transcludes "bar" text',function(){expect(e(0).text()).toBe("22 %")}),it("it should be possible to add additional classes",function(){s=a('<progress class="progress-striped active" max="200"><bar class="pizza"></bar></progress>')(t),t.$digest(),expect(s).toHaveClass("progress-striped"),expect(s).toHaveClass("active"),expect(e(0)).toHaveClass("pizza")}),it('adjusts the "bar" width and aria when value changes',function(){t.value=60,t.$digest();var a=e(0);expect(a.css("width")).toBe("60%"),expect(a.attr("aria-valuemin")).toBe("0"),expect(a.attr("aria-valuemax")).toBe("100"),expect(a.attr("aria-valuenow")).toBe("60"),expect(a.attr("aria-valuetext")).toBe("60%")}),it('allows fractional "bar" width values, rounded to two places',function(){t.value=5.625,t.$digest(),expect(e(0).css("width")).toBe("5.63%"),t.value=1.3,t.$digest(),expect(e(0).css("width")).toBe("1.3%")}),it("does not include decimals in aria values",function(){t.value=50.34,t.$digest();var a=e(0);expect(a.css("width")).toBe("50.34%"),expect(a.attr("aria-valuetext")).toBe("50%")}),describe('"max" attribute',function(){beforeEach(inject(function(){t.max=200,s=a('<uib-progressbar max="max" animate="false" value="value">{{value}}/{{max}}</uib-progressbar>')(t),t.$digest()})),it("has the appropriate aria markup",function(){expect(e(0).attr("aria-valuemax")).toBe("200")}),it('adjusts the "bar" width',function(){expect(s.children().eq(0).css("width")).toBe("11%")}),it('adjusts the "bar" width when value changes',function(){t.value=60,t.$digest(),expect(e(0).css("width")).toBe("30%"),t.value+=12,t.$digest(),expect(e(0).css("width")).toBe("36%"),t.value=0,t.$digest(),expect(e(0).css("width")).toBe("0%")}),it('transcludes "bar" text',function(){expect(e(0).text()).toBe("22/200")}),it("adjusts the valuemax when it changes",function(){expect(e(0).attr("aria-valuemax")).toBe("200"),t.max=300,t.$digest(),expect(e(0).attr("aria-valuemax")).toBe("300")})}),describe('"max" attribute using object',function(){beforeEach(inject(function(){s=a('<uib-progressbar max="settings.max" animate="false" value="settings.value">{{settings.value}}/{{settings.max}}</uib-progressbar>')(t),t.$digest()})),it("should not modify outside object",function(){"object"==typeof t.settings&&expect(t.settings.max).toBeUndefined(),expect(t.settings).toBeUndefined(),expect(e(0).attr("aria-valuemax")).toBe("100"),t.settings={max:300,value:40},t.$digest(),expect(t.settings.max).toBe(300),expect(e(0).attr("aria-valuemax")).toBe("300")})}),describe('"type" attribute',function(){beforeEach(inject(function(){t.type="success",s=a('<uib-progressbar value="value" type="{{type}}"></uib-progressbar>')(t),t.$digest()})),it("should use correct classes",function(){expect(e(0)).toHaveClass(i),expect(e(0)).toHaveClass(i+"-success")}),it("should change classes if type changed",function(){t.type="warning",t.value+=1,t.$digest();var a=e(0);expect(a).toHaveClass(i),expect(a).not.toHaveClass(i+"-success"),expect(a).toHaveClass(i+"-warning")})}),describe("stacked",function(){beforeEach(inject(function(){t.objects=[{value:10,title:"foo",type:"success"},{value:50,title:"bar",type:"warning"},{value:20,title:"baz"}],s=a('<uib-progress animate="false"><uib-bar ng-repeat="o in objects" value="o.value" type="{{o.type}}" title="{{o.title}}">{{o.value}}</uib-bar></uib-progress>')(t),t.$digest()})),it("contains the right number of bars",function(){expect(s.children().length).toBe(3);for(var t=0;3>t;t++)expect(e(t)).toHaveClass(i)}),it("renders each bar with the appropriate width",function(){expect(e(0).css("width")).toBe("10%"),expect(e(1).css("width")).toBe("50%"),expect(e(2).css("width")).toBe("20%")}),it("uses correct classes",function(){expect(e(0)).toHaveClass(i+"-success"),expect(e(0)).not.toHaveClass(i+"-warning"),expect(e(1)).not.toHaveClass(i+"-success"),expect(e(1)).toHaveClass(i+"-warning"),expect(e(2)).not.toHaveClass(i+"-success"),expect(e(2)).not.toHaveClass(i+"-warning")}),it("should change classes if type changed",function(){t.objects=[{value:20,type:"warning"},{value:50},{value:30,type:"info"}],t.$digest(),expect(e(0)).not.toHaveClass(i+"-success"),expect(e(0)).toHaveClass(i+"-warning"),expect(e(1)).not.toHaveClass(i+"-success"),expect(e(1)).not.toHaveClass(i+"-warning"),expect(e(2)).toHaveClass(i+"-info"),expect(e(2)).not.toHaveClass(i+"-success"),expect(e(2)).not.toHaveClass(i+"-warning")}),it("should change classes if type changed",function(){t.objects=[{value:70,type:"info"}],t.$digest(),expect(s.children().length).toBe(1),expect(e(0)).toHaveClass(i+"-info"),expect(e(0)).not.toHaveClass(i+"-success"),expect(e(0)).not.toHaveClass(i+"-warning")}),it("should have the correct aria markup",function(){expect(e(0).attr("aria-valuenow")).toBe("10"),expect(e(0).attr("aria-valuemin")).toBe("0"),expect(e(0).attr("aria-valuemax")).toBe("100"),expect(e(0).attr("aria-valuetext")).toBe("10%"),expect(e(0).attr("aria-labelledby")).toBe("foo"),expect(e(1).attr("aria-valuenow")).toBe("50"),expect(e(1).attr("aria-valuemin")).toBe("0"),expect(e(1).attr("aria-valuemax")).toBe("100"),expect(e(1).attr("aria-valuetext")).toBe("50%"),expect(e(1).attr("aria-labelledby")).toBe("bar"),expect(e(2).attr("aria-valuenow")).toBe("20"),expect(e(2).attr("aria-valuemin")).toBe("0"),expect(e(2).attr("aria-valuemax")).toBe("100"),expect(e(2).attr("aria-valuetext")).toBe("20%"),expect(e(2).attr("aria-labelledby")).toBe("baz")}),it("should default to `progressbar`",function(){t.objects=[{value:10,title:"foo",type:"success"},{value:50,title:"bar",type:"warning"},{value:20,title:"baz"}],s=a('<uib-progress animate="false"><uib-bar ng-repeat="o in objects" value="o.value" type="{{o.type}}">{{o.value}}</uib-bar></uib-progress>')(t),t.$digest(),expect(e(0).attr("aria-labelledby")).toBe("progressbar"),expect(e(1).attr("aria-labelledby")).toBe("progressbar"),expect(e(2).attr("aria-labelledby")).toBe("progressbar")}),describe('"max" attribute',function(){beforeEach(inject(function(){t.max=200,s=a('<uib-progress max="max" animate="false"><uib-bar ng-repeat="o in objects" value="o.value">{{o.value}}/{{max}}</uib-bar></uib-progress>')(t),t.$digest()})),it("has the appropriate aria markup",function(){expect(e(0).attr("aria-valuemax")).toBe("200")}),it('adjusts the "bar" width when it changes',function(){expect(e(0).css("width")).toBe("5%"),t.max=250,t.$digest(),expect(e(0).css("width")).toBe("4%")}),it('adjusts the "bar" width when value changes',function(){t.objects[0].value=60,t.$digest(),expect(e(0).css("width")).toBe("30%"),t.objects[0].value+=12,t.$digest(),expect(e(0).css("width")).toBe("36%"),t.objects[0].value=0,t.$digest(),expect(e(0).css("width")).toBe("0%")}),it('transcludes "bar" text',function(){expect(e(0).text()).toBe("10/200")}),it("adjusts the valuemax when it changes",function(){expect(e(0).attr("aria-valuemax")).toBe("200"),t.max=300,t.$digest(),expect(e(0).attr("aria-valuemax")).toBe("300")}),it("should not have a total width over 100%",function(){t.objects=[{value:60,type:"warning"},{value:103},{value:270,type:"info"}],t.max=433,t.$digest();for(var a=0,s=0;3>s;s++)a+=parseFloat(e(s).css("width"));expect(a.toFixed(2)).toBe("100.00")}),it("should not have a total width over 37.65% when removing bar",function(){t.objects=[{value:60,type:"warning"},{value:103},{value:270,type:"info"}],t.max=433,t.$digest();var a,s=0;for(a=0;3>a;a++)s+=parseFloat(e(a).css("width"));for(expect(s.toFixed(2)).toBe("100.00"),t.objects.splice(2,1),t.$digest(),s=0,a=0;2>a;a++)s+=parseFloat(e(a).css("width"));expect(s.toFixed(2)).toBe("37.65")})})})});