describe("rating directive",function(){function e(){return c.find("i")}function t(t){return e().eq(t-1)}function a(t,a){for(var i=e(),n=[],o=0,r=i.length;r>o;o++)n.push(i.eq(o).hasClass(t||"glyphicon-star")&&!i.eq(o).hasClass(a||"glyphicon-star-empty"));return n}function i(){var t=e();return t.toArray().map(function(e){return angular.element(e).attr("title")})}function n(e){var t=$.Event("keydown");t.which=e,c.trigger(t)}var o,r,c;beforeEach(module("ui.bootstrap.rating")),beforeEach(module("uib/template/rating/rating.html")),beforeEach(inject(function(e,t){r=e,o=t,o.rate=3,c=r('<uib-rating ng-model="rate"></uib-rating>')(o),o.$digest()})),it("contains the default number of icons",function(){expect(e().length).toBe(5),expect(c.attr("aria-valuemax")).toBe("5")}),it("initializes the default star icons as selected",function(){expect(a()).toEqual([!0,!0,!0,!1,!1]),expect(c.attr("aria-valuenow")).toBe("3")}),it("handles correctly the click event",function(){t(2).click(),o.$digest(),expect(a()).toEqual([!0,!0,!1,!1,!1]),expect(o.rate).toBe(2),expect(c.attr("aria-valuenow")).toBe("2"),t(5).click(),o.$digest(),expect(a()).toEqual([!0,!0,!0,!0,!0]),expect(o.rate).toBe(5),expect(c.attr("aria-valuenow")).toBe("5"),t(5).click(),o.$digest(),expect(a()).toEqual([!1,!1,!1,!1,!1]),expect(o.rate).toBe(0),expect(c.attr("aria-valuenow")).toBe("0")}),it("handles correctly the hover event",function(){t(2).trigger("mouseover"),o.$digest(),expect(a()).toEqual([!0,!0,!1,!1,!1]),expect(o.rate).toBe(3),t(5).trigger("mouseover"),o.$digest(),expect(a()).toEqual([!0,!0,!0,!0,!0]),expect(o.rate).toBe(3),c.trigger("mouseout"),expect(a()).toEqual([!0,!0,!0,!1,!1]),expect(o.rate).toBe(3)}),it("rounds off the number of stars shown with decimal values",function(){o.rate=2.1,o.$digest(),expect(a()).toEqual([!0,!0,!1,!1,!1]),expect(c.attr("aria-valuenow")).toBe("2"),o.rate=2.5,o.$digest(),expect(a()).toEqual([!0,!0,!0,!1,!1]),expect(c.attr("aria-valuenow")).toBe("3")}),it("changes the number of selected icons when value changes",function(){o.rate=2,o.$digest(),expect(a()).toEqual([!0,!0,!1,!1,!1]),expect(c.attr("aria-valuenow")).toBe("2"),expect(c.attr("aria-valuetext")).toBe("two")}),it("shows different number of icons when `max` attribute is set",function(){c=r('<uib-rating ng-model="rate" max="7"></uib-rating>')(o),o.$digest(),expect(e().length).toBe(7),expect(c.attr("aria-valuemax")).toBe("7")}),it("shows different number of icons when `max` attribute is from scope variable",function(){o.max=15,c=r('<uib-rating ng-model="rate" max="max"></uib-rating>')(o),o.$digest(),expect(e().length).toBe(15),expect(c.attr("aria-valuemax")).toBe("15")}),it("handles read-only attribute",function(){o.isReadonly=!0,c=r('<uib-rating ng-model="rate" read-only="isReadonly"></uib-rating>')(o),o.$digest(),expect(a()).toEqual([!0,!0,!0,!1,!1]);var e=t(5);e.trigger("mouseover"),o.$digest(),expect(a()).toEqual([!0,!0,!0,!1,!1]),o.isReadonly=!1,o.$digest(),e.trigger("mouseover"),o.$digest(),expect(a()).toEqual([!0,!0,!0,!0,!0])}),it("handles enable-reset attribute",function(){o.canReset=!1,c=r('<uib-rating ng-model="rate" enable-reset="canReset"></uib-rating>')(o),o.$digest();var e={states:[!0,!0,!0,!0,!0],rating:5},i=t(e.rating);i.click(),o.$digest(),expect(a()).toEqual(e.states),expect(o.rate).toBe(5),expect(c.attr("aria-valuenow")).toBe("5"),i.click(),o.$digest(),expect(a()).toEqual(e.states),expect(o.rate).toBe(5),expect(c.attr("aria-valuenow")).toBe("5")}),it("should fire onHover",function(){o.hoveringOver=jasmine.createSpy("hoveringOver"),c=r('<uib-rating ng-model="rate" on-hover="hoveringOver(value)"></uib-rating>')(o),o.$digest(),t(3).trigger("mouseover"),o.$digest(),expect(o.hoveringOver).toHaveBeenCalledWith(3)}),it("should fire onLeave",function(){o.leaving=jasmine.createSpy("leaving"),c=r('<uib-rating ng-model="rate" on-leave="leaving()"></uib-rating>')(o),o.$digest(),c.trigger("mouseleave"),o.$digest(),expect(o.leaving).toHaveBeenCalled()}),describe("keyboard navigation",function(){it("supports arrow keys",function(){n(38),expect(o.rate).toBe(4),n(37),expect(o.rate).toBe(3),n(40),expect(o.rate).toBe(2),n(39),expect(o.rate).toBe(3)}),it("supports only arrow keys",function(){o.rate=void 0,o.$digest(),n(36),expect(o.rate).toBe(void 0),n(41),expect(o.rate).toBe(void 0)}),it("can get zero value but not negative",function(){o.rate=1,o.$digest(),n(37),expect(o.rate).toBe(0),n(37),expect(o.rate).toBe(0)}),it("cannot get value above max",function(){o.rate=4,o.$digest(),n(38),expect(o.rate).toBe(5),n(38),expect(o.rate).toBe(5)})}),describe("custom states",function(){beforeEach(inject(function(){o.classOn="icon-ok-sign",o.classOff="icon-ok-circle",c=r('<uib-rating ng-model="rate" state-on="classOn" state-off="classOff"></uib-rating>')(o),o.$digest()})),it("changes the default icons",function(){expect(a(o.classOn,o.classOff)).toEqual([!0,!0,!0,!1,!1])})}),describe("`rating-states`",function(){beforeEach(inject(function(){o.states=[{stateOn:"sign",stateOff:"circle"},{stateOn:"heart",stateOff:"ban"},{stateOn:"heart"},{stateOff:"off"}],c=r('<uib-rating ng-model="rate" rating-states="states"></uib-rating>')(o),o.$digest()})),it("should define number of icon elements",function(){expect(e().length).toBe(4),expect(c.attr("aria-valuemax")).toBe("4")}),it("handles each icon",function(){for(var t=e(),a=0;a<t.length;a++){var i=t.eq(a),n=o.states[a],r=a<o.rate;expect(i.hasClass(n.stateOn)).toBe(r),expect(i.hasClass(n.stateOff)).toBe(!r)}})}),describe("setting uibRatingConfig",function(){var t={};beforeEach(inject(function(e){o.rate=5,angular.extend(t,e),e.max=10,e.stateOn="on",e.stateOff="off",c=r('<uib-rating ng-model="rate"></uib-rating>')(o),o.$digest()})),afterEach(inject(function(e){angular.extend(e,t)})),it("should change number of icon elements",function(){expect(e().length).toBe(10)}),it("should change icon states",function(){expect(a("on","off")).toEqual([!0,!0,!0,!0,!0,!1,!1,!1,!1,!1])})}),describe("Default title",function(){it("should return the default title for each star",function(){expect(i()).toEqual(["one","two","three","four","five"])})}),describe("shows different title when `max` attribute is greater than the titles array ",function(){var e={};beforeEach(inject(function(t){o.rate=5,angular.extend(e,t),t.max=10,c=r('<uib-rating ng-model="rate"></uib-rating>')(o),o.$digest()})),afterEach(inject(function(t){angular.extend(t,e)})),it("should return the default title for each star",function(){expect(i()).toEqual(["one","two","three","four","five","6","7","8","9","10"])})}),describe("shows custom titles ",function(){it("should return the custom title for each star",function(){o.titles=[44,45,46],c=r('<uib-rating ng-model="rate" titles="titles"></uib-rating>')(o),o.$digest(),expect(i()).toEqual(["44","45","46","4","5"])}),it("should return the default title if the custom title is empty",function(){o.titles=[],c=r('<uib-rating ng-model="rate" titles="titles"></uib-rating>')(o),o.$digest(),expect(i()).toEqual(["one","two","three","four","five"])}),it("should return the default title if the custom title is not an array",function(){c=r('<uib-rating ng-model="rate" titles="test"></uib-rating>')(o),o.$digest(),expect(i()).toEqual(["one","two","three","four","five"])})})});