describe("datepicker popup",function(){function e(){return element.find("th").eq(1).find("button").first()}function t(){return e().text()}function n(){e().click()}function i(){return element.find("thead").find("tr").eq(1)}function o(e){for(var t=i().find("th"),n=[],o=e?1:0,a=t.length;a>o;o++)n.push(t.eq(o).text());return n}function a(e){for(var t=element.find("tbody").find("tr"),n=[],i=0,o=t.length;o>i;i++){for(var a=t.eq(i).find("td"),d=[],p=e?1:0,c=a.length;c>p;p++)d.push(a.eq(p).find("button").text());n.push(d)}return n}function d(e){p().eq(e).click()}function p(e){return element.find("tbody").find("button")}function c(){for(var e=p(),t=0;t<e.length;t++)if(angular.element(e[t]).hasClass("btn-info"))return t}function u(e){var t=p();angular.forEach(t,function(t,n){expect(angular.element(t).hasClass("btn-info")).toBe(n===e)})}function r(e){var t=p(),n=$.grep(t,function(e,t){return angular.element(e).hasClass("btn-info")})[0];return angular.element(n)}function l(e,t,n){var i={enter:13,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,esc:27},o=$.Event("keydown");o.which=i[t],n&&(o.ctrlKey=!0),e.trigger(o)}function s(e){h=e.find("input"),g=e.find("ul"),element=g.find("table")}function f(e,t){e.val(t),e.trigger(x.hasEvent("input")?"input":"change"),m.$digest()}var h,g,b,v,m,x,y,k;beforeEach(module("ui.bootstrap.datepickerPopup")),beforeEach(module("uib/template/datepicker/datepicker.html")),beforeEach(module("uib/template/datepicker/day.html")),beforeEach(module("uib/template/datepicker/month.html")),beforeEach(module("uib/template/datepicker/year.html")),beforeEach(module("uib/template/datepickerPopup/popup.html")),beforeEach(inject(function(e,t,n){b=e,m=t,m.date=new Date("September 30, 2010 15:30:00"),y=n})),describe("basic",function(){function e(e){n=e.find("input"),i=e.find("ul"),element=i.find("table")}var t,n,i;beforeEach(function(){m.date=new Date("September 30, 2010 15:30:00"),m.isopen=!0,t=b('<div><input ng-model="date" uib-datepicker-popup is-open="isopen"></div>')(m),m.$digest(),e(t)}),it("should stop click event from bubbling from today button",function(){var e=!1;t.on("click",function(){e=!0}),t.find(".uib-datepicker-current").trigger("click"),expect(e).toBe(!1)}),it("should stop click event from bubbling from clear button",function(){var e=!1;t.on("click",function(){e=!0}),t.find(".uib-clear").trigger("click"),expect(e).toBe(!1)}),it("should stop click event from bubbling from close button",function(){var e=!1;t.on("click",function(){e=!0}),t.find(".uib-close").trigger("click"),expect(e).toBe(!1)})}),describe("ngModelOptions allowInvalid",function(){function e(e,t){e.val(t),e.trigger(x.hasEvent("input")?"input":"change"),m.$digest()}beforeEach(inject(function(e){x=e,m.date=new Date("September 30, 2010 15:30:00"),m.modelOptions={allowInvalid:!0},element=b('<div><input ng-model="date" ng-model-options="modelOptions" uib-datepicker-popup></div>')(m),h=element.find("input"),m.$digest()})),it("should update ng-model even if the date is invalid when allowInvalid is true",function(){e(h,"pizza"),expect(m.date).toBe("pizza"),expect(h.val()).toBe("pizza")})}),describe("setting datepickerPopupConfig",function(){var e={};beforeEach(inject(function(t){angular.extend(e,t),t.datepickerPopup="MM-dd-yyyy",element=b('<input ng-model="date" uib-datepicker-popup>')(m),m.$digest()})),afterEach(inject(function(t){angular.extend(t,e)})),it("changes date format",function(){expect(element.val()).toEqual("09-30-2010")})}),describe("setting datepickerPopupConfig inside ng-if",function(){var e={};beforeEach(inject(function(t){angular.extend(e,t),t.datepickerPopup="MM-dd-yyyy",element=b('<div><div ng-if="true"><input ng-model="date" uib-datepicker-popup></div></div>')(m),m.$digest()})),afterEach(inject(function(t){angular.extend(t,e)})),it("changes date format",function(){expect(element.find("input").val()).toEqual("09-30-2010")})}),describe("initially",function(){beforeEach(inject(function(e,t){v=e,x=t,m.isopen=!0,m.date=new Date("September 30, 2010 15:30:00");var n=b('<div><input ng-model="date" uib-datepicker-popup><div>')(m);m.$digest(),s(n)})),it("does not to display datepicker initially",function(){expect(g.length).toBe(0)}),it("to display the correct value in input",function(){expect(h.val()).toBe("2010-09-30")})}),describe("initially opened",function(){var e;beforeEach(inject(function(t,n,i){v=t,x=n,k=i,m.isopen=!0,m.date=new Date("September 30, 2010 15:30:00"),e=b('<div><input ng-model="date" uib-datepicker-popup is-open="isopen"><div>')(m),m.$digest(),s(e)})),it("datepicker is displayed",function(){expect(g.length).toBe(1)}),it("renders the calendar correctly",function(){expect(i().css("display")).not.toBe("none"),expect(o(!0)).toEqual(["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]),expect(a(!0)).toEqual([["29","30","31","01","02","03","04"],["05","06","07","08","09","10","11"],["12","13","14","15","16","17","18"],["19","20","21","22","23","24","25"],["26","27","28","29","30","01","02"],["03","04","05","06","07","08","09"]])}),it("updates the input when a day is clicked",function(){d(17),expect(h.val()).toBe("2010-09-15"),expect(m.date).toEqual(new Date("September 15, 2010 15:30:00"))}),it("should mark the input field dirty when a day is clicked",function(){expect(h).toHaveClass("ng-pristine"),d(17),expect(h).toHaveClass("ng-dirty")}),it("updates the input correctly when model changes",function(){m.date=new Date("January 10, 1983 10:00:00"),m.$digest(),expect(h.val()).toBe("1983-01-10")}),it("closes the dropdown when a day is clicked",function(){expect(g.length).toBe(1),d(17),s(e),expect(g.length).toBe(0)}),it("updates the model & calendar when input value changes",function(){f(h,"2010-09-15"),expect(m.date.getFullYear()).toEqual(2010),expect(m.date.getMonth()).toEqual(8),expect(m.date.getDate()).toEqual(15),expect(a(!0)).toEqual([["29","30","31","01","02","03","04"],["05","06","07","08","09","10","11"],["12","13","14","15","16","17","18"],["19","20","21","22","23","24","25"],["26","27","28","29","30","01","02"],["03","04","05","06","07","08","09"]]),u(17)}),it("closes when click outside of calendar",function(){expect(g.length).toBe(1),k.flush(0),v.find("body").click(),s(e),expect(g.length).toBe(0)}),it("sets `ng-invalid` for invalid input",function(){f(h,"pizza"),expect(h).toHaveClass("ng-invalid"),expect(h).toHaveClass("ng-invalid-date"),expect(m.date).toBeUndefined(),expect(h.val()).toBe("pizza")}),it("unsets `ng-invalid` for valid input",function(){f(h,"pizza"),expect(h).toHaveClass("ng-invalid-date"),m.date=new Date("August 11, 2013"),m.$digest(),expect(h).not.toHaveClass("ng-invalid"),expect(h).not.toHaveClass("ng-invalid-date")}),describe("focus",function(){beforeEach(function(){var e=v.find("body");e.append(h),e.append(g)}),afterEach(function(){h.remove(),g.remove()}),it("returns to the input when ESC key is pressed in the popup and closes",function(){expect(g.length).toBe(1),g.find("button").eq(0).focus(),expect(document.activeElement.tagName).toBe("BUTTON"),l(g,"esc"),s(e),expect(g.length).toBe(0),expect(document.activeElement.tagName).toBe("INPUT")}),it("returns to the input when ESC key is pressed in the input and closes",function(){expect(g.length).toBe(1),g.find("button").eq(0).focus(),expect(document.activeElement.tagName).toBe("BUTTON"),l(h,"esc"),m.$digest(),s(e),expect(g.length).toBe(0),expect(document.activeElement.tagName).toBe("INPUT")}),it("stops the ESC key from propagating if the dropdown is open, but not when closed",function(){var e=-1,t=function(t){e=t.which};v.bind("keydown",t),l(h,"esc"),expect(e).toBe(-1),l(h,"esc"),expect(e).toBe(27),v.unbind("keydown",t)})}),describe("works with HTML5 date input types",function(){function e(e){var t=b('<div><input type="'+e+'" ng-model="date" uib-datepicker-popup is-open="isopen"><div>')(m);m.$digest(),s(t)}new Date("October 1, 2010 12:34:56.789");beforeEach(inject(function(e){v=e,m.isopen=!0,m.date=new Date("September 30, 2010 15:30:00")})),it("works as date",function(){e("date"),expect(g.length).toBe(1),expect(h.val()).toBe("2010-09-30"),f(h,"1980-03-05"),expect(m.date.getFullYear()).toEqual(1980),expect(m.date.getMonth()).toEqual(2),expect(m.date.getDate()).toEqual(5),expect(a(!0)).toEqual([["24","25","26","27","28","29","01"],["02","03","04","05","06","07","08"],["09","10","11","12","13","14","15"],["16","17","18","19","20","21","22"],["23","24","25","26","27","28","29"],["30","31","01","02","03","04","05"]]),expect(c()).toEqual(10)}),it("works as datetime-local",function(){e("datetime-local"),expect(h.val()).toBe("2010-09-30T15:30:00.000"),f(h,"1980-03-05T12:34:56.000"),expect(m.date.getFullYear()).toEqual(1980),expect(m.date.getMonth()).toEqual(2),expect(m.date.getDate()).toEqual(5),expect(a(!0)).toEqual([["24","25","26","27","28","29","01"],["02","03","04","05","06","07","08"],["09","10","11","12","13","14","15"],["16","17","18","19","20","21","22"],["23","24","25","26","27","28","29"],["30","31","01","02","03","04","05"]]),expect(c()).toEqual(10)}),it("works as month",function(){e("month"),expect(h.val()).toBe("2010-09"),f(h,"1980-03"),expect(m.date.getFullYear()).toEqual(1980),expect(m.date.getMonth()).toEqual(2),expect(m.date.getDate()).toEqual(30),expect(a()).toEqual([["January","February","March"],["April","May","June"],["July","August","September"],["October","November","December"]]),expect(c()).toEqual(2)})})}),describe("works with ngModelOptions",function(){var e;beforeEach(inject(function(t,n,i){v=t,e=i,m.isopen=!0,m.date=new Date("September 30, 2010 15:30:00");var o=b('<div><input ng-model="date" ng-model-options="{ debounce: 10000 }" uib-datepicker-popup is-open="isopen"><div>')(m);m.$digest(),s(o)})),it("should change model and update calendar after debounce timeout",function(){f(h,"1980-03-05"),expect(m.date.getFullYear()).toEqual(2010),expect(m.date.getMonth()).toEqual(8),expect(m.date.getDate()).toEqual(30),expect(a(!0)).toEqual([["29","30","31","01","02","03","04"],["05","06","07","08","09","10","11"],["12","13","14","15","16","17","18"],["19","20","21","22","23","24","25"],["26","27","28","29","30","01","02"],["03","04","05","06","07","08","09"]]),e.flush(2e3),expect(m.date.getFullYear()).toEqual(2010),expect(m.date.getMonth()).toEqual(8),expect(m.date.getDate()).toEqual(30),expect(a(!0)).toEqual([["29","30","31","01","02","03","04"],["05","06","07","08","09","10","11"],["12","13","14","15","16","17","18"],["19","20","21","22","23","24","25"],["26","27","28","29","30","01","02"],["03","04","05","06","07","08","09"]]),e.flush(1e4),expect(m.date.getFullYear()).toEqual(1980),expect(m.date.getMonth()).toEqual(2),expect(m.date.getDate()).toEqual(5),expect(a(!0)).toEqual([["24","25","26","27","28","29","01"],["02","03","04","05","06","07","08"],["09","10","11","12","13","14","15"],["16","17","18","19","20","21","22"],["23","24","25","26","27","28","29"],["30","31","01","02","03","04","05"]]),u(10)})}),describe('works with ngModelOptions updateOn : "default"',function(){var e,t;beforeEach(inject(function(n,i,o){v=n,e=o,m.isopen=!0,m.date=new Date("2010-09-30T10:00:00.000Z"),t=b('<div><input ng-model="date" ng-model-options="{ updateOn: \'default\' }" uib-datepicker-popup is-open="isopen"><div>')(m),m.$digest(),s(t)})),it("should close the popup and update the input when a day is clicked",function(){d(17),s(t),expect(g.length).toBe(0),expect(h.val()).toBe("2010-09-15"),expect(m.date).toEqual(new Date("2010-09-15T10:00:00.000Z"))})}),describe("attribute `datepickerOptions`",function(){describe("show-weeks",function(){beforeEach(function(){m.opts={showWeeks:!1};var e=b('<div><input ng-model="date" uib-datepicker-popup datepicker-options="opts" is-open="true"></div>')(m);m.$digest(),s(e)}),it("hides week numbers based on variable",function(){expect(i().find("th").length).toEqual(7);for(var e=element.find("tbody").find("tr"),t=0;5>t;t++)expect(e.eq(t).find("td").length).toEqual(7)})}),describe("init-date",function(){beforeEach(function(){m.date=null,m.opts={initDate:new Date("November 9, 1980")};var e=b('<div><input ng-model="date" uib-datepicker-popup datepicker-options="opts" is-open="true"></div>')(m);m.$digest(),s(e)}),it("does not alter the model",function(){expect(m.date).toBe(null)}),it("shows the correct title",function(){expect(t()).toBe("November 1980")})}),describe("min-date",function(){it("should be able to specify a min-date through options",function(){m.opts={minDate:new Date("September 12, 2010"),shortcutPropagation:"dog"};var e=b('<div><input ng-model="date" uib-datepicker-popup datepicker-options="opts" is-open="true"></div>')(m);m.$digest(),s(e);var t=p();angular.forEach(t,function(e,t){expect(angular.element(e).prop("disabled")).toBe(14>t)}),m.opts.minDate=new Date("September 13, 2010"),m.$digest(),t=p(),angular.forEach(t,function(e,t){expect(angular.element(e).prop("disabled")).toBe(15>t)})})}),describe("max-date",function(){it("should be able to specify a max-date through options",function(){m.opts={maxDate:new Date("September 25, 2010")};var e=b('<div><input ng-model="date" uib-datepicker-popup datepicker-options="opts" is-open="true"></div>')(m);m.$digest(),s(e);var t=p();angular.forEach(t,function(e,t){expect(angular.element(e).prop("disabled")).toBe(t>27)}),m.opts.maxDate=new Date("September 15, 2010"),m.$digest(),t=p(),angular.forEach(t,function(e,t){expect(angular.element(e).prop("disabled")).toBe(t>17)})})}),describe("min-mode",function(){it("should be able to specify min-mode through options",function(){m.opts={minMode:"month"};var e=b('<div><input ng-model="date" uib-datepicker-popup datepicker-options="opts" is-open="true"></div>')(m);m.$digest(),s(e),expect(t()).toBe("2010")})}),describe("max-mode",function(){it("should be able to specify max-mode through options",function(){m.opts={maxMode:"month"};var e=b('<div><input ng-model="date" uib-datepicker-popup datepicker-options="opts" is-open="true"></div>')(m);m.$digest(),s(e),expect(t()).toBe("September 2010"),n(),s(e),expect(t()).toBe("2010"),n(),s(e),expect(t()).toBe("2010")})}),describe("datepicker-mode",function(){beforeEach(inject(function(){m.date=new Date("August 11, 2013"),m.opts={datepickerMode:"month"};var e=b('<div><input ng-model="date" uib-datepicker-popup datepicker-options="opts" is-open="true"></div>')(m);m.$digest(),s(e)})),it("shows the correct title",function(){expect(t()).toBe("2013")}),it("updates binding",function(){n(),expect(m.opts.datepickerMode).toBe("year")})})}),describe("option `init-date`",function(){beforeEach(function(){m.date=null,m.options={initDate:new Date("November 9, 1980")}}),describe("when initially set",function(){beforeEach(function(){var e=b('<div><input ng-model="date" uib-datepicker-popup datepicker-options="options" is-open="true"></div>')(m);m.$digest(),s(e)}),it("does not alter the model",function(){expect(m.date).toBe(null)}),it("shows the correct title",function(){expect(t()).toBe("November 1980")})}),describe("when modified before date selected.",function(){beforeEach(function(){var e=b('<div><input ng-model="date" uib-datepicker-popup datepicker-options="options" is-open="true"></div>')(m);m.$digest(),s(e),m.options.initDate=new Date("December 20, 1981"),m.$digest()}),it("does not alter the model",function(){expect(m.date).toBe(null)}),it("shows the correct title",function(){expect(t()).toBe("December 1981")})}),describe("when modified after date selected.",function(){beforeEach(function(){var e=b('<div><input ng-model="date" uib-datepicker-popup datepicker-options="options" is-open="true"></div>')(m);m.$digest(),s(e),m.date=new Date("April 1, 1982"),m.options.initDate=new Date("December 20, 1981"),m.$digest()}),it("does not alter the model",function(){expect(m.date).toEqual(new Date("April 1, 1982"))}),it("shows the correct title",function(){expect(t()).toBe("April 1982")})})}),describe("toggles programatically by `open` attribute",function(){var e;beforeEach(inject(function(){m.open=!0,e=b('<div><input ng-model="date" uib-datepicker-popup is-open="open"><div>')(m),m.$digest(),s(e)})),it("to display initially",function(){expect(g.length).toBe(1)}),it("to close / open from scope variable",function(){expect(g.length).toBe(1),m.open=!1,m.$digest(),s(e),expect(g.length).toBe(0),m.open=!0,m.$digest(),s(e),expect(g.length).toBe(1)})}),describe("custom format",function(){beforeEach(inject(function(){var e=b('<div><input ng-model="date" uib-datepicker-popup="dd-MMMM-yyyy" is-open="true"><div>')(m);m.$digest(),s(e)})),it("to display the correct value in input",function(){expect(h.val()).toBe("30-September-2010")}),it("updates the input when a day is clicked",function(){d(17),expect(h.val()).toBe("15-September-2010"),expect(m.date).toEqual(new Date("September 15, 2010 15:30:00"))}),it("updates the input correctly when model changes",function(){m.date=new Date("January 10, 1983 10:00:00"),m.$digest(),expect(h.val()).toBe("10-January-1983")})}),describe("custom format with time",function(){beforeEach(inject(function(){var e=b('<div><input type="text" ng-model="date" uib-datepicker-popup="MMM-d-yyyy h:mm a" is-open="false"><div>')(m);m.$digest(),s(e)})),it("updates the model correctly when the input value changes",function(){m.date=new Date(2015,10,24,10,0),m.$digest(),expect(h.val()).toBe("Nov-24-2015 10:00 AM"),h.val("Nov-24-2015 11:00 AM").trigger("input"),m.$digest(),expect(m.date).toEqual(new Date(2015,10,24,11,0))})}),describe("custom format with optional leading zeroes",function(){beforeEach(inject(function(){var e=b('<div><input ng-model="date" uib-datepicker-popup="d!-M!-yyyy" is-open="true"><div>')(m);m.$digest(),s(e)})),it("to display the correct value in input",function(){expect(h.val()).toBe("30-09-2010")}),it("updates the input when a day is clicked",function(){d(10),expect(h.val()).toBe("08-09-2010"),expect(m.date).toEqual(new Date("September 8, 2010 15:30:00"))}),it("updates the input correctly when model changes",function(){m.date=new Date("December 25, 1983 10:00:00"),m.$digest(),expect(h.val()).toBe("25-12-1983")})}),describe("dynamic custom format",function(){beforeEach(inject(function(){m.format="dd-MMMM-yyyy";var e=b('<div><input ng-model="date" uib-datepicker-popup="{{format}}" is-open="true"><div>')(m);m.$digest(),s(e)})),it("to display the correct value in input",function(){expect(h.val()).toBe("30-September-2010")}),it("updates the input when a day is clicked",function(){d(17),expect(h.val()).toBe("15-September-2010"),expect(m.date).toEqual(new Date("September 15, 2010 15:30:00"))}),it("updates the input correctly when model changes",function(){m.date=new Date("August 11, 2013 09:09:00"),m.$digest(),expect(h.val()).toBe("11-August-2013")}),it("updates the input correctly when format changes",function(){m.format="dd/MM/yyyy",m.$digest(),expect(h.val()).toBe("30/09/2010")})}),describe("format errors",function(){var e={};beforeEach(inject(function(t){angular.extend(e,t),t.datepickerPopup=null})),afterEach(inject(function(t){angular.extend(t,e)})),it("should throw an error if there is no format",function(){expect(function(){b('<div><input ng-model="date" uib-datepicker-popup><div>')(m)}).toThrow(new Error("uibDatepickerPopup must have a date format specified."))}),it("should throw an error if the format changes to null without fallback",function(){m.format="dd-MMMM-yyyy",b('<div><input ng-model="date" uib-datepicker-popup="{{format}}"><div>')(m),m.$digest(),expect(function(){m.format=null,m.$digest()}).toThrow(new Error("uibDatepickerPopup must have a date format specified."))}),it("should thrown an error on date inputs with custom formats",function(){expect(function(){b('<div><input type="date" ng-model="date" uib-datepicker-popup="dd-yyyy-MMM"><div>')(m)}).toThrow(new Error("HTML5 date input types do not support custom formats."))})}),describe("european format",function(){it("dd.MM.yyyy",function(){var e=b('<div><input ng-model="date" uib-datepicker-popup="dd.MM.yyyy"><div>')(m);m.$digest(),s(e),f(h,"11.08.2013"),expect(m.date.getFullYear()).toEqual(2013),expect(m.date.getMonth()).toEqual(7),expect(m.date.getDate()).toEqual(11)})}),describe("`close-on-date-selection` attribute",function(){var e;beforeEach(inject(function(){m.close=!1,e=b('<div><input ng-model="date" uib-datepicker-popup close-on-date-selection="close" is-open="true"><div>')(m),m.$digest(),s(e)})),it("does not close the dropdown when a day is clicked",function(){d(17),s(e),expect(g.length).toBe(1)})}),describe("button bar",function(){function e(){n=g.find("li").eq(-1),t=n.find("button")}var t,n;describe("",function(){var n;beforeEach(inject(function(){m.isopen=!0,n=b('<div><input ng-model="date" uib-datepicker-popup is-open="isopen"><div>')(m),m.$digest(),s(n),e()})),it("should exist",function(){expect(g.length).toBe(1),expect(g.find("li").length).toBe(2)}),it("should have three buttons",function(){expect(t.length).toBe(3),expect(t.eq(0).text()).toBe("Today"),expect(t.eq(1).text()).toBe("Clear"),expect(t.eq(2).text()).toBe("Done")}),it("should have a button to set today date without altering time part",function(){var e=new Date;t.eq(0).click(),expect(m.date.getFullYear()).toBe(e.getFullYear()),expect(m.date.getMonth()).toBe(e.getMonth()),expect(m.date.getDate()).toBe(e.getDate()),expect(m.date.getHours()).toBe(15),expect(m.date.getMinutes()).toBe(30),expect(m.date.getSeconds()).toBe(0)}),it("should have a button to set today date if blank",function(){m.date=null,m.$digest();var e=new Date;t.eq(0).click(),expect(m.date.getFullYear()).toBe(e.getFullYear()),expect(m.date.getMonth()).toBe(e.getMonth()),expect(m.date.getDate()).toBe(e.getDate()),expect(m.date.getHours()).toBe(0),expect(m.date.getMinutes()).toBe(0),expect(m.date.getSeconds()).toBe(0)}),it("should have a button to clear value",function(){t.eq(1).click(),expect(m.date).toBe(null)}),it("should have a button to close calendar",function(){t.eq(2).click(),s(n),expect(g.length).toBe(0)})}),describe("customization",function(){it("should change text from attributes",function(){m.clearText="Null it!",m.close="Close";var n=b('<div><input ng-model="date" uib-datepicker-popup current-text="Now" clear-text="{{clearText}}" close-text="{{close}}ME" is-open="true"><div>')(m);m.$digest(),s(n),e(),expect(t.eq(0).text()).toBe("Now"),expect(t.eq(1).text()).toBe("Null it!"),expect(t.eq(2).text()).toBe("CloseME")}),it("should disable today button if before min date",function(){var n=new Date;n.setDate((new Date).getDate()+1),m.options={minDate:n};var i=b('<div><input ng-model="date" uib-datepicker-popup datepicker-options="options" is-open="true"><div>')(m);m.$digest(),s(i),e(),expect(t.eq(0).prop("disabled")).toBe(!0)}),it("should disable today button if before min date, yyyy-MM-dd case",inject(function(n){var i=new Date;i.setDate((new Date).getDate()+1);var o=n(i,"yyyy-MM-dd");m.options={minDate:o};var a=b('<div><input ng-model="date" uib-datepicker-popup="yyyy-MM-dd" datepicker-options="options" is-open="true"><div>')(m);m.$digest(),s(a),e(),expect(t.eq(0).prop("disabled")).toBe(!0)})),it("should not disable any button if min date is null",function(){m.options={minDate:null};var n=b('<div><input ng-model="date" uib-datepicker-popup datepicker-options="options" is-open="true"><div>')(m);m.$digest(),s(n),e();for(var i=0;i<t.length;i++)expect(t.eq(i).prop("disabled")).toBe(!1)}),it("should disable today button if after max date",function(){var n=new Date;n.setDate((new Date).getDate()-2),m.options={maxDate:n};var i=b('<div><input ng-model="date" uib-datepicker-popup datepicker-options="options" is-open="true"><div>')(m);m.$digest(),s(i),e(),expect(t.eq(0).prop("disabled")).toBe(!0)}),it("should not disable any button if max date is null",function(){m.options={maxDate:null};var n=b('<div><input ng-model="date" uib-datepicker-popup datepicker-options="options" is-open="true"><div>')(m);m.$digest(),s(n),e();for(var i=0;i<t.length;i++)expect(t.eq(i).prop("disabled")).toBe(!1)}),it("should remove bar",function(){m.showBar=!1;var e=b('<div><input ng-model="date" uib-datepicker-popup show-button-bar="showBar" is-open="true"><div>')(m);m.$digest(),s(e),expect(g.find("li").length).toBe(1)}),it("should hide weeks column on popup",function(){m.options={showWeeks:!1};var e=b('<div><input ng-model="date" uib-datepicker-popup datepicker-options="options" is-open="true"><div>')(m);m.$digest(),s(e),expect(i().find("th").length).toEqual(7);for(var t=element.find("tbody").find("tr"),n=0;5>n;n++)expect(t.eq(n).find("td").length).toEqual(7)}),it("should show weeks column on popup",function(){m.options={showWeeks:!0};var e=b('<div><input ng-model="date" uib-datepicker-popup datepicker-options="options" is-open="true"><div>')(m);m.$digest(),s(e),expect(i().find("th").eq(0)).not.toBeHidden();for(var t=element.find("tbody").find("tr"),n=0;5>n;n++)expect(t.eq(n).find("td").eq(0)).not.toBeHidden()})}),describe("`ng-change`",function(){beforeEach(inject(function(){m.changeHandler=jasmine.createSpy("changeHandler");var t=b('<div><input ng-model="date" uib-datepicker-popup ng-change="changeHandler()" is-open="true"><div>')(m);m.$digest(),s(t),e()})),it("should be called when `today` is clicked",function(){t.eq(0).click(),expect(m.changeHandler).toHaveBeenCalled()}),it("should be called when `clear` is clicked",function(){t.eq(1).click(),expect(m.changeHandler).toHaveBeenCalled()}),it("should not be called when `close` is clicked",function(){t.eq(2).click(),expect(m.changeHandler).not.toHaveBeenCalled()})})}),describe("use with `ng-required` directive",function(){describe("`ng-required is true`",function(){beforeEach(inject(function(){m.date="";var e=b('<div><input ng-model="date" uib-datepicker-popup ng-required="true"><div>')(m);m.$digest(),s(e)})),it("should be invalid initially and when no date",function(){expect(h.hasClass("ng-invalid")).toBeTruthy()}),it("should be valid if model has been specified",function(){m.date=new Date,m.$digest(),expect(h.hasClass("ng-valid")).toBeTruthy()}),it("should be valid if model value is a valid timestamp",function(){m.date=Date.now(),m.$digest(),expect(h.hasClass("ng-valid")).toBeTruthy()})}),describe("`ng-required is false`",function(){beforeEach(inject(function(){m.date="";var e=b('<div><input ng-model="date" uib-datepicker-popup ng-required="false"><div>')(m);m.$digest(),s(e)})),it("should be valid initially and when no date",function(){expect(h.hasClass("ng-valid")).toBeTruthy()})})}),describe("use with `ng-change` directive",function(){beforeEach(inject(function(){m.changeHandler=jasmine.createSpy("changeHandler"),m.date=new Date("09/16/2010");var e=b('<div><input ng-model="date" uib-datepicker-popup ng-required="true" ng-change="changeHandler()" is-open="true"><div>')(m);m.$digest(),s(e)})),it("should not be called initially",function(){expect(m.changeHandler).not.toHaveBeenCalled()}),it("should be called when a day is clicked",function(){d(17),expect(m.changeHandler).toHaveBeenCalled()}),it("should not be called when model changes programatically",function(){m.date=new Date,m.$digest(),expect(m.changeHandler).not.toHaveBeenCalled()})}),describe("with disabled",function(){var e;beforeEach(function(){m.isOpen=!1,e=b('<div><input ng-model="date" uib-datepicker-popup ng-required="true" ng-change="changeHandler()" is-open="isOpen" disabled><div>')(m),m.$digest()}),it("should not open the popup",function(){m.isOpen=!0,m.$digest(),expect(m.isOpen).toBe(!1),expect(e.find("ul").length).toBe(0)})}),describe("with ng-disabled",function(){var e;beforeEach(function(){m.disabled=!1,m.isOpen=!1,e=b('<div><input ng-model="date" uib-datepicker-popup ng-required="true" ng-change="changeHandler()" is-open="isOpen" ng-disabled="disabled"><div>')(m),m.$digest()}),it("should not open the popup when disabled",function(){m.isOpen=!0,m.$digest(),expect(m.isOpen).toBe(!0),expect(e.find("ul").length).toBe(1),m.isOpen=!1,m.$digest(),expect(m.isOpen).toBe(!1),expect(e.find("ul").length).toBe(0),m.disabled=!0,m.isOpen=!0,m.$digest(),expect(m.isOpen).toBe(!1),expect(e.find("ul").length).toBe(0),m.disabled=!1,m.isOpen=!0,m.$digest(),expect(m.isOpen).toBe(!0),expect(e.find("ul").length).toBe(1)})}),describe("with datepicker-popup-template-url",function(){beforeEach(function(){m.date=new Date}),afterEach(function(){v.find("body").find(".dropdown-menu").remove()}),it("should allow custom templates for the popup",function(){y.put("foo/bar.html","<div>baz</div>");var e=angular.element('<div><input ng-model="date" uib-datepicker-popup datepicker-popup-template-url="foo/bar.html" is-open="true"></div>');b(e)(m),m.$digest(),expect(e.children().eq(1).html()).toBe("baz")})}),describe("with datepicker-template-url",function(){beforeEach(function(){m.date=new Date}),afterEach(function(){v.find("body").find(".dropdown-menu").remove()}),it("should allow custom templates for the datepicker",function(){y.put("foo/bar.html","<div>baz</div>");var e=angular.element('<div><input ng-model="date" uib-datepicker-popup datepicker-template-url="foo/bar.html" is-open="true"></div>');b(e)(m),m.$digest();var t=e.find("[uib-datepicker]");expect(t.html()).toBe("baz")})}),describe("with an append-to-body attribute",function(){beforeEach(function(){m.date=new Date}),afterEach(function(){v.find("body").children().remove()}),it("should append to the body",function(){var e=v.find("body"),t=e.children().length,n=angular.element('<div><input uib-datepicker-popup ng-model="date" datepicker-append-to-body="true" is-open="true" /></div>');b(n)(m),m.$digest(),expect(e.children().length).toEqual(t+1),expect(n.children().length).toEqual(1)}),it("should be removed on scope destroy",function(){var e=v.find("body"),t=e.children().length,n=m.$new(),i=angular.element('<input uib-datepicker-popup ng-model="date" datepicker-append-to-body="true" is-open="true" />');b(i)(n),n.$digest(),expect(e.children().length).toEqual(t+1),n.$destroy(),expect(e.children().length).toEqual(t)})}),describe("with setting datepickerConfig.showWeeks to false",function(){var e={};beforeEach(inject(function(t){angular.extend(e,t),t.showWeeks=!1;var n=b('<div><input ng-model="date" uib-datepicker-popup is-open="true"><div>')(m);m.$digest(),s(n)})),afterEach(inject(function(t){angular.extend(t,e)})),it("changes initial visibility for weeks",function(){expect(i().find("th").length).toEqual(7);for(var e=element.find("tbody").find("tr"),t=0;5>t;t++)expect(e.eq(t).find("td").length).toEqual(7)})}),describe("`datepicker-mode`",function(){beforeEach(inject(function(){m.date=new Date("August 11, 2013"),m.options={datepickerMode:"month"};var e=b('<div><input ng-model="date" uib-datepicker-popup datepicker-options="options" is-open="true"></div>')(m);m.$digest(),s(e)})),it("shows the correct title",function(){expect(t()).toBe("2013")}),it("updates binding",function(){n(),expect(m.options.datepickerMode).toBe("year")})}),describe("attribute `onOpenFocus`",function(){beforeEach(function(){m.date=null,m.isopen=!1;var e=b('<div><input ng-model="date" uib-datepicker-popup on-open-focus="false" is-open="isopen"></div>')(m);m.$digest(),s(e)}),it("should remain focused on the input",function(){var e=!0;expect(g.length).toBe(0),h[0].focus(),h.on("blur",function(){e=!1}),m.isopen=!0,m.$digest(),expect(h.parent().find(".dropdown-menu").length).toBe(1),expect(e).toBe(!0)})}),describe("altInputFormats",function(){describe("datepickerPopupConfig.altInputFormats",function(){var e={};beforeEach(inject(function(t){m.date=new Date("November 9, 1980"),angular.extend(e,t),t.datepickerPopup="MM-dd-yyyy",t.altInputFormats=["M!/d!/yyyy"];var n=b('<div><input ng-model="date" uib-datepicker-popup is-open="true"></div>')(m);m.$digest(),s(n)})),afterEach(inject(function(t){angular.extend(t,e)})),it("changes date format",function(){f(h,"11/8/1980"),expect(m.date.getFullYear()).toEqual(1980),expect(m.date.getMonth()).toEqual(10),expect(m.date.getDate()).toEqual(8)}),it("changes the datepicker",function(){expect(c()).toEqual(14),f(h,"11/8/1980"),expect(c()).toEqual(13)})}),describe("attribute `alt-input-formats`",function(){beforeEach(function(){m.date=new Date("November 9, 1980");
var e=b('<div><input ng-model="date" uib-datepicker-popup="MMMM d yyyy" alt-input-formats="[\'M!/d!/yyyy\']" is-open="true"></div>')(m);m.$digest(),s(e)}),it("should accept alternate input formats",function(){f(h,"11/8/1980"),expect(m.date.getFullYear()).toEqual(1980),expect(m.date.getMonth()).toEqual(10),expect(m.date.getDate()).toEqual(8)}),it("changes the datepicker",function(){expect(c()).toEqual(14),f(h,"11/8/1980"),expect(c()).toEqual(13)})})}),describe("uibDatepickerConfig ngModelOptions",function(){function e(e){n=e.find("input"),i=e.find("ul"),element=i.find("table")}var n,i;beforeEach(inject(function(e){e.ngModelOptions={timezone:"+600"},m.date=new Date("2010-09-30T10:00:00.000Z"),m.isopen=!0})),afterEach(inject(function(e){e.ngModelOptions={}})),describe("timezone",function(){beforeEach(inject(function(t){var n=b('<div><input ng-model="date" uib-datepicker-popup="MM/dd/yyyy" is-open="isopen"></div>')(m);m.$digest(),e(n)})),it("interprets the date appropriately",function(){expect(n.val()).toBe("09/30/2010")}),it("updates the input when a day is clicked",function(){d(17),expect(n.val()).toBe("09/15/2010"),expect(m.date).toEqual(new Date("2010-09-15T10:00:00.000Z"))}),it("shows the correct title",function(){expect(t()).toBe("September 2010")})}),it("timezone interprets init date appropriately",function(){m.options={initDate:new Date("2010-09-30T23:00:00.000Z")},m.date=null;var n=b('<div><input ng-model="date" uib-datepicker-popup="yyyy-MM-dd" datepicker-options="options" is-open="true"><div>')(m);m.$digest(),e(n),expect(t()).toBe("October 2010")}),it("timezone interprets min date appropriately",function(){m.options={minDate:new Date("2010-10-01T00:00:00.000Z")};var t=b('<div><input ng-model="date" uib-datepicker-popup="yyyy-MM-dd" datepicker-options="options" is-open="true"><div>')(m);m.$digest(),e(t),expect(r().prop("disabled")).toBe(!0)})}),describe("ng-model-options",function(){describe("timezone",function(){function e(e){t=e.find("input"),n=e.find("ul"),element=n.find("table")}var t,n;beforeEach(function(){m.date=new Date("2010-09-30T10:00:00.000Z"),m.ngModelOptions={timezone:"+600"},m.isopen=!0;var t=b('<div><input ng-model="date" uib-datepicker-popup="MM/dd/yyyy" ng-model-options="ngModelOptions" is-open="isopen"></div>')(m);m.$digest(),e(t)}),it("interprets the date appropriately",function(){expect(t.val()).toBe("09/30/2010")}),it("has `selected` only the correct day",function(){u(32)}),it("updates the input when a day is clicked",function(){d(17),expect(t.val()).toBe("09/15/2010"),expect(m.date).toEqual(new Date("2010-09-15T10:00:00.000Z"))})}),describe("timezone HTML5 date input",function(){function e(e){t=e.find("input"),n=e.find("ul"),element=n.find("table")}var t,n;beforeEach(function(){m.date=new Date("2010-09-30T10:00:00.000Z"),m.ngModelOptions={timezone:"+600"},m.isopen=!0;var t=b('<div><input type="date" ng-model="date" uib-datepicker-popup ng-model-options="ngModelOptions" is-open="isopen"></div>')(m);m.$digest(),e(t)}),it("interprets the date appropriately",function(){expect(t.val()).toBe("2010-09-30")}),it("has `selected` only the correct day",function(){u(32)}),it("updates the input when a day is clicked",function(){d(17),expect(t.val()).toBe("2010-09-15"),expect(m.date).toEqual(new Date("2010-09-15T10:00:00.000Z"))})})})});