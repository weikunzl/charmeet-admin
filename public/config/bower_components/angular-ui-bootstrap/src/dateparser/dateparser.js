angular.module("ui.bootstrap.dateparser",[]).service("uibDateParser",["$log","$locale","dateFilter","orderByFilter",function(e,t,r,n){function i(e,t){var r=[],i=e.split(""),a=e.indexOf("'");if(a>-1){var o=!1;e=e.split("");for(var s=a;s<e.length;s++)o?("'"===e[s]&&(s+1<e.length&&"'"===e[s+1]?(e[s+1]="$",i[s+1]=""):(i[s]="",o=!1)),e[s]="$"):"'"===e[s]&&(e[s]="$",i[s]="",o=!0);e=e.join("")}return angular.forEach(h,function(n){var a=e.indexOf(n.key);if(a>-1){e=e.split(""),i[a]="("+n.regex+")",e[a]="$";for(var o=a+1,s=a+n.key.length;s>o;o++)i[o]="",e[o]="$";e=e.join(""),r.push({index:a,key:n.key,apply:n[t],matcher:n.regex})}}),{regex:new RegExp("^"+i.join("")+"$"),map:n(r,"index")}}function a(e,t,r){return 1>r?!1:1===t&&r>28?29===r&&(e%4===0&&e%100!==0||e%400===0):3===t||5===t||8===t||10===t?31>r:!0}function o(e){return parseInt(e,10)}function s(e,t){return e&&t?c(e,t):e}function u(e,t){return e&&t?c(e,t,!0):e}function f(e,t){var r=Date.parse("Jan 01, 1970 00:00:00 "+e)/6e4;return isNaN(r)?t:r}function l(e,t){return e=new Date(e.getTime()),e.setMinutes(e.getMinutes()+t),e}function c(e,t,r){r=r?-1:1;var n=f(t,e.getTimezoneOffset());return l(e,r*(n-e.getTimezoneOffset()))}var y,h,p=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g;this.init=function(){y=t.id,this.parsers={},this.formatters={},h=[{key:"yyyy",regex:"\\d{4}",apply:function(e){this.year=+e},formatter:function(e){var t=new Date;return t.setFullYear(Math.abs(e.getFullYear())),r(t,"yyyy")}},{key:"yy",regex:"\\d{2}",apply:function(e){e=+e,this.year=69>e?e+2e3:e+1900},formatter:function(e){var t=new Date;return t.setFullYear(Math.abs(e.getFullYear())),r(t,"yy")}},{key:"y",regex:"\\d{1,4}",apply:function(e){this.year=+e},formatter:function(e){var t=new Date;return t.setFullYear(Math.abs(e.getFullYear())),r(t,"y")}},{key:"M!",regex:"0?[1-9]|1[0-2]",apply:function(e){this.month=e-1},formatter:function(e){var t=e.getMonth();return/^[0-9]$/.test(t)?r(e,"MM"):r(e,"M")}},{key:"MMMM",regex:t.DATETIME_FORMATS.MONTH.join("|"),apply:function(e){this.month=t.DATETIME_FORMATS.MONTH.indexOf(e)},formatter:function(e){return r(e,"MMMM")}},{key:"MMM",regex:t.DATETIME_FORMATS.SHORTMONTH.join("|"),apply:function(e){this.month=t.DATETIME_FORMATS.SHORTMONTH.indexOf(e)},formatter:function(e){return r(e,"MMM")}},{key:"MM",regex:"0[1-9]|1[0-2]",apply:function(e){this.month=e-1},formatter:function(e){return r(e,"MM")}},{key:"M",regex:"[1-9]|1[0-2]",apply:function(e){this.month=e-1},formatter:function(e){return r(e,"M")}},{key:"d!",regex:"[0-2]?[0-9]{1}|3[0-1]{1}",apply:function(e){this.date=+e},formatter:function(e){var t=e.getDate();return/^[1-9]$/.test(t)?r(e,"dd"):r(e,"d")}},{key:"dd",regex:"[0-2][0-9]{1}|3[0-1]{1}",apply:function(e){this.date=+e},formatter:function(e){return r(e,"dd")}},{key:"d",regex:"[1-2]?[0-9]{1}|3[0-1]{1}",apply:function(e){this.date=+e},formatter:function(e){return r(e,"d")}},{key:"EEEE",regex:t.DATETIME_FORMATS.DAY.join("|"),formatter:function(e){return r(e,"EEEE")}},{key:"EEE",regex:t.DATETIME_FORMATS.SHORTDAY.join("|"),formatter:function(e){return r(e,"EEE")}},{key:"HH",regex:"(?:0|1)[0-9]|2[0-3]",apply:function(e){this.hours=+e},formatter:function(e){return r(e,"HH")}},{key:"hh",regex:"0[0-9]|1[0-2]",apply:function(e){this.hours=+e},formatter:function(e){return r(e,"hh")}},{key:"H",regex:"1?[0-9]|2[0-3]",apply:function(e){this.hours=+e},formatter:function(e){return r(e,"H")}},{key:"h",regex:"[0-9]|1[0-2]",apply:function(e){this.hours=+e},formatter:function(e){return r(e,"h")}},{key:"mm",regex:"[0-5][0-9]",apply:function(e){this.minutes=+e},formatter:function(e){return r(e,"mm")}},{key:"m",regex:"[0-9]|[1-5][0-9]",apply:function(e){this.minutes=+e},formatter:function(e){return r(e,"m")}},{key:"sss",regex:"[0-9][0-9][0-9]",apply:function(e){this.milliseconds=+e},formatter:function(e){return r(e,"sss")}},{key:"ss",regex:"[0-5][0-9]",apply:function(e){this.seconds=+e},formatter:function(e){return r(e,"ss")}},{key:"s",regex:"[0-9]|[1-5][0-9]",apply:function(e){this.seconds=+e},formatter:function(e){return r(e,"s")}},{key:"a",regex:t.DATETIME_FORMATS.AMPMS.join("|"),apply:function(e){12===this.hours&&(this.hours=0),"PM"===e&&(this.hours+=12)},formatter:function(e){return r(e,"a")}},{key:"Z",regex:"[+-]\\d{4}",apply:function(e){var t=e.match(/([+-])(\d{2})(\d{2})/),r=t[1],n=t[2],i=t[3];this.hours+=o(r+n),this.minutes+=o(r+i)},formatter:function(e){return r(e,"Z")}},{key:"ww",regex:"[0-4][0-9]|5[0-3]",formatter:function(e){return r(e,"ww")}},{key:"w",regex:"[0-9]|[1-4][0-9]|5[0-3]",formatter:function(e){return r(e,"w")}},{key:"GGGG",regex:t.DATETIME_FORMATS.ERANAMES.join("|").replace(/\s/g,"\\s"),formatter:function(e){return r(e,"GGGG")}},{key:"GGG",regex:t.DATETIME_FORMATS.ERAS.join("|"),formatter:function(e){return r(e,"GGG")}},{key:"GG",regex:t.DATETIME_FORMATS.ERAS.join("|"),formatter:function(e){return r(e,"GG")}},{key:"G",regex:t.DATETIME_FORMATS.ERAS.join("|"),formatter:function(e){return r(e,"G")}}]},this.init(),this.filter=function(e,r){if(!angular.isDate(e)||isNaN(e)||!r)return"";r=t.DATETIME_FORMATS[r]||r,t.id!==y&&this.init(),this.formatters[r]||(this.formatters[r]=i(r,"formatter"));var n=this.formatters[r],a=n.map,o=r;return a.reduce(function(t,r,n){var i=o.match(new RegExp("(.*)"+r.key));i&&angular.isString(i[1])&&(t+=i[1],o=o.replace(i[1]+r.key,""));var s=n===a.length-1?o:"";return r.apply?t+r.apply.call(null,e)+s:t+s},"")},this.parse=function(r,n,o){if(!angular.isString(r)||!n)return r;n=t.DATETIME_FORMATS[n]||n,n=n.replace(p,"\\$&"),t.id!==y&&this.init(),this.parsers[n]||(this.parsers[n]=i(n,"apply"));var s=this.parsers[n],u=s.regex,f=s.map,l=r.match(u),c=!1;if(l&&l.length){var h,m;angular.isDate(o)&&!isNaN(o.getTime())?h={year:o.getFullYear(),month:o.getMonth(),date:o.getDate(),hours:o.getHours(),minutes:o.getMinutes(),seconds:o.getSeconds(),milliseconds:o.getMilliseconds()}:(o&&e.warn("dateparser:","baseDate is not a valid date"),h={year:1900,month:0,date:1,hours:0,minutes:0,seconds:0,milliseconds:0});for(var g=1,M=l.length;M>g;g++){var T=f[g-1];"Z"===T.matcher&&(c=!0),T.apply&&T.apply.call(h,l[g])}var d=c?Date.prototype.setUTCFullYear:Date.prototype.setFullYear,E=c?Date.prototype.setUTCHours:Date.prototype.setHours;return a(h.year,h.month,h.date)&&(!angular.isDate(o)||isNaN(o.getTime())||c?(m=new Date(0),d.call(m,h.year,h.month,h.date),E.call(m,h.hours||0,h.minutes||0,h.seconds||0,h.milliseconds||0)):(m=new Date(o),d.call(m,h.year,h.month,h.date),E.call(m,h.hours,h.minutes,h.seconds,h.milliseconds))),m}},this.toTimezone=s,this.fromTimezone=u,this.timezoneToOffset=f,this.addDateMinutes=l,this.convertTimezoneToLocal=c}]);