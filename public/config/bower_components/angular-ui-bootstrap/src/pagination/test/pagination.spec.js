describe("pagination directive",function(){function e(){return x.find("li").length}function t(e){return x.find("li").eq(e)}function i(){for(var i=e(),n=[],a=0;i>a;a++)n.push(t(a).text());return n.join(", ")}function n(e){t(e).find("a").click()}function a(e,t){return e.find("li").eq(t).find("a")}function o(e){u.currentPage=e,u.$digest()}function s(e){u.disabled=e,u.$digest()}var c,u,l,r,p,x;beforeEach(module("ui.bootstrap.pagination")),beforeEach(module("uib/template/pagination/pagination.html")),beforeEach(inject(function(e,t,i,n){c=e,u=t,u.total=47,u.currentPage=3,u.disabled=!1,l=i,r=n,p=l.find("body"),x=c('<uib-pagination total-items="total" ng-model="currentPage"></uib-pagination>')(u),u.$digest()})),it('has a "pagination" css class',function(){expect(x.hasClass("pagination")).toBe(!0)}),it("exposes the controller to the template",function(){r.put("uib/template/pagination/pagination.html","<div>{{pagination.randomText}}</div>");var e=u.$new();x=c("<uib-pagination></uib-pagination>")(e),u.$digest();var t=x.controller("uibPagination");expect(t).toBeDefined(),t.randomText="foo",u.$digest(),expect(x.html()).toBe("foo")}),it("allows custom templates",function(){r.put("foo/bar.html","<div>baz</div>");var e=u.$new();x=c('<uib-pagination template-url="foo/bar.html"></uib-pagination>')(e),u.$digest(),expect(x.html()).toBe("baz")}),it("contains num-pages + 2 li elements",function(){expect(e()).toBe(7),expect(t(0).text()).toBe("Previous"),expect(t(-1).text()).toBe("Next")}),it("has the number of the page as text in each page item",function(){for(var e=1;5>=e;e++)expect(t(e).text()).toEqual(""+e)}),it("sets the current page to be active",function(){expect(t(u.currentPage).hasClass("active")).toBe(!0)}),it('disables the "previous" link if current page is 1',function(){o(1),expect(t(0).hasClass("disabled")).toBe(!0)}),it('disables the "next" link if current page is last',function(){o(5),expect(t(-1).hasClass("disabled")).toBe(!0)}),it("changes currentPage if a page link is clicked",function(){n(2),expect(u.currentPage).toBe(2)}),it('changes currentPage if the "previous" link is clicked',function(){n(0),expect(u.currentPage).toBe(2)}),it('changes currentPage if the "next" link is clicked',function(){n(-1),expect(u.currentPage).toBe(4)}),it('does not change the current page on "previous" click if already at first page',function(){o(1),n(0),expect(u.currentPage).toBe(1)}),it('does not change the current page on "next" click if already at last page',function(){o(5),n(-1),expect(u.currentPage).toBe(5)}),it("changes the number of pages when `total-items` changes",function(){u.total=78,u.$digest(),expect(e()).toBe(10),expect(t(0).text()).toBe("Previous"),expect(t(-1).text()).toBe("Next")}),it('does not "break" when `total-items` is undefined',function(){u.total=void 0,u.$digest(),expect(e()).toBe(3),expect(t(0)).toHaveClass("disabled"),expect(t(1)).toHaveClass("active"),expect(t(2)).toHaveClass("disabled")}),it('does not "break" when `total-items` is negative',function(){u.total=-1,u.$digest(),expect(e()).toBe(3),expect(t(0)).toHaveClass("disabled"),expect(t(1)).toHaveClass("active"),expect(t(2)).toHaveClass("disabled")}),it("does not change the current page when `total-items` changes but is valid",function(){u.currentPage=1,u.total=18,u.$digest(),expect(u.currentPage).toBe(1)}),it("should blur a page link after it has been clicked",function(){p.append(x);var e=a(x,2);e.focus(),expect(e).toHaveFocus(),e.click(),expect(e).not.toHaveFocus(),x.remove()}),it('should blur the "next" link after it has been clicked',function(){p.append(x);var e=a(x,-1);e.focus(),expect(e).toHaveFocus(),e.click(),expect(e).not.toHaveFocus(),x.remove()}),it('should blur the "prev" link after it has been clicked',function(){p.append(x);var e=a(x,0);e.focus(),expect(e).toHaveFocus(),e.click(),expect(e).not.toHaveFocus(),x.remove()}),describe("`items-per-page`",function(){beforeEach(function(){u.perpage=5,x=c('<uib-pagination total-items="total" items-per-page="perpage" ng-model="currentPage"></uib-pagination>')(u),u.$digest()}),it("changes the number of pages",function(){expect(e()).toBe(12),expect(t(0).text()).toBe("Previous"),expect(t(-1).text()).toBe("Next")}),it("changes the number of pages when changes",function(){u.perpage=20,u.$digest(),expect(e()).toBe(5),expect(t(0).text()).toBe("Previous"),expect(t(-1).text()).toBe("Next")}),it("selects the last page when current page is too big",function(){u.perpage=30,u.$digest(),expect(u.currentPage).toBe(2),expect(e()).toBe(4),expect(t(0).text()).toBe("Previous"),expect(t(-1).text()).toBe("Next")}),it("displays a single page when it is negative",function(){u.perpage=-1,u.$digest(),expect(e()).toBe(3),expect(t(0).text()).toBe("Previous"),expect(t(1).text()).toBe("1"),expect(t(-1).text()).toBe("Next")})}),describe("executes `ng-change` expression",function(){beforeEach(function(){u.selectPageHandler=jasmine.createSpy("selectPageHandler"),x=c('<uib-pagination total-items="total" ng-model="currentPage" ng-change="selectPageHandler()"></uib-pagination>')(u),u.$digest()}),it("when an element is clicked",function(){n(2),expect(u.selectPageHandler).toHaveBeenCalled()})}),describe("when `page` is not a number",function(){it("handles numerical string",function(){o("2"),expect(t(2)).toHaveClass("active"),o("04"),expect(t(4)).toHaveClass("active")}),it("defaults to 1 if non-numeric",function(){o("pizza"),expect(t(1)).toHaveClass("active")})}),describe("with `max-size` option",function(){beforeEach(function(){u.total=98,u.currentPage=3,u.maxSize=5,x=c('<uib-pagination total-items="total" ng-model="currentPage" max-size="maxSize"></uib-pagination>')(u),u.$digest()}),it("contains maxsize + 2 li elements",function(){expect(e()).toBe(u.maxSize+2),expect(t(0).text()).toBe("Previous"),expect(t(-1).text()).toBe("Next")}),it("shows the page number even if it can't be shown in the middle",function(){o(1),expect(t(1)).toHaveClass("active"),o(10),expect(t(-2)).toHaveClass("active")}),it("shows the page number in middle after the next link is clicked",function(){o(6),n(-1),expect(u.currentPage).toBe(7),expect(t(3)).toHaveClass("active"),expect(t(3).text()).toBe(""+u.currentPage)}),it("shows the page number in middle after the prev link is clicked",function(){o(7),n(0),expect(u.currentPage).toBe(6),expect(t(3)).toHaveClass("active"),expect(t(3).text()).toBe(""+u.currentPage)}),it("changes pagination bar size when max-size value changed",function(){u.maxSize=7,u.$digest(),expect(e()).toBe(9)}),it("sets the pagination bar size to num-pages, if max-size is greater than num-pages ",function(){u.maxSize=15,u.$digest(),expect(e()).toBe(12)}),it("should not change value of max-size expression, if max-size is greater than num-pages ",function(){u.maxSize=15,u.$digest(),expect(u.maxSize).toBe(15)}),it("should not display page numbers, if max-size is zero",function(){u.maxSize=0,u.$digest(),expect(e()).toBe(2),expect(t(0).text()).toBe("Previous"),expect(t(-1).text()).toBe("Next")}),it("should blur page link when visible range changes",function(){p.append(x);var e=a(x,4);e.focus(),expect(e).toHaveFocus(),e.click(),expect(e).not.toHaveFocus(),x.remove()})}),describe("with `force-ellipses` option",function(){beforeEach(function(){u.total=98,u.currentPage=3,u.maxSize=5,x=c('<uib-pagination total-items="total" ng-model="currentPage" max-size="maxSize" force-ellipses="true"></uib-pagination>')(u),u.$digest()}),it("contains maxsize + 3 li elements",function(){expect(e()).toBe(u.maxSize+3),expect(t(0).text()).toBe("Previous"),expect(t(-1).text()).toBe("Next"),expect(t(-2).text()).toBe("...")}),it("shows the page number in middle after the next link is clicked",function(){o(6),n(-1),expect(u.currentPage).toBe(7),expect(t(4)).toHaveClass("active"),expect(t(4).text()).toBe(""+u.currentPage)}),it("shows the page number in middle after the prev link is clicked",function(){o(7),n(0),expect(u.currentPage).toBe(6),expect(t(4)).toHaveClass("active"),expect(t(4).text()).toBe(""+u.currentPage)}),it("changes pagination bar size when max-size value changed",function(){u.maxSize=7,u.$digest(),expect(e()).toBe(10)}),it("should display an ellipsis on the right if the last displayed page's number is less than the last page",function(){o(1),expect(i()).toBe("Previous, 1, 2, 3, 4, 5, ..., Next")}),it("should display an ellipsis on the left if the first displayed page's number is greater than 1",function(){o(10),expect(i()).toBe("Previous, ..., 6, 7, 8, 9, 10, Next")}),it("should display both ellipsis' if the displayed range is in the middle",function(){o(5),expect(i()).toBe("Previous, ..., 3, 4, 5, 6, 7, ..., Next")}),it("should not display any ellipses if the number of pages >= maxsize",function(){u.maxSize=10,u.$digest(),expect(i()).toBe("Previous, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, Next")})}),describe("with `boundary-link-numbers` option",function(){beforeEach(function(){u.total=98,u.currentPage=3,u.maxSize=5,x=c('<uib-pagination total-items="total" ng-model="currentPage" max-size="maxSize" boundary-link-numbers="true"></uib-pagination>')(u),u.$digest()}),it("contains maxsize + 4 li elements",function(){expect(e()).toBe(u.maxSize+4),expect(t(0).text()).toBe("Previous"),expect(t(-1).text()).toBe("Next"),expect(t(-2).text()).toBe("10"),expect(t(-3).text()).toBe("...")}),it("shows the page number in middle after the next link is clicked",function(){o(6),n(-1),expect(u.currentPage).toBe(7),expect(t(5)).toHaveClass("active"),expect(t(5).text()).toBe(""+u.currentPage)}),it("shows the page number in middle after the prev link is clicked",function(){o(7),n(0),expect(u.currentPage).toBe(6),expect(t(5)).toHaveClass("active"),expect(t(5).text()).toBe(""+u.currentPage)}),it("changes pagination bar size when max-size value changed",function(){u.maxSize=7,u.$digest(),expect(e()).toBe(11)}),it("should display an ellipsis on the right if the last displayed page's number is less than the last page",function(){o(1),expect(i()).toBe("Previous, 1, 2, 3, 4, 5, ..., 10, Next")}),it("should display an ellipsis on the left if the first displayed page's number is greater than 1",function(){o(10),expect(i()).toBe("Previous, 1, ..., 6, 7, 8, 9, 10, Next")}),it("should display both ellipses if the displayed range is in the middle",function(){u.maxSize=3,u.$digest(),o(6),expect(i()).toBe("Previous, 1, ..., 5, 6, 7, ..., 10, Next")}),it("should not display any ellipses if the number of pages >= maxsize",function(){u.maxSize=10,u.$digest(),expect(i()).toBe("Previous, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, Next")}),it("should not display an ellipsis on the left if the start page is 2",function(){o(4),expect(i()).toBe("Previous, 1, 2, 3, 4, 5, 6, ..., 10, Next")}),it("should not display an ellipsis on the left if the start page is 3",function(){o(5),expect(i()).toBe("Previous, 1, 2, 3, 4, 5, 6, 7, ..., 10, Next")}),it("should not display an ellipsis on the right if the end page is totalPages - 1",function(){o(7),expect(i()).toBe("Previous, 1, ..., 5, 6, 7, 8, 9, 10, Next")}),it("should not display an ellipsis on the right if the end page is totalPages - 2",function(){o(6),expect(i()).toBe("Previous, 1, ..., 4, 5, 6, 7, 8, 9, 10, Next")}),it("should not display any ellipses if the number of pages <= maxsize + 4 and current page is in center",function(){u.total=88,u.$digest(),o(5),expect(i()).toBe("Previous, 1, 2, 3, 4, 5, 6, 7, 8, 9, Next")})}),describe("with `max-size` option & no `rotate`",function(){beforeEach(function(){u.total=115,u.currentPage=7,u.maxSize=5,u.rotate=!1,x=c('<uib-pagination total-items="total" ng-model="currentPage" max-size="maxSize" rotate="rotate"></uib-pagination>')(u),u.$digest()}),it("contains maxsize + 4 elements",function(){expect(e()).toBe(u.maxSize+4),expect(t(0).text()).toBe("Previous"),expect(t(1).text()).toBe("..."),expect(t(2).text()).toBe("6"),expect(t(-3).text()).toBe("10"),expect(t(-2).text()).toBe("..."),expect(t(-1).text()).toBe("Next")}),it("shows only the next ellipsis element on first page set",function(){o(3),expect(t(1).text()).toBe("1"),expect(t(-3).text()).toBe("5"),expect(t(-2).text()).toBe("...")}),it("shows only the previous ellipsis element on last page set",function(){o(12),expect(e()).toBe(5),expect(t(1).text()).toBe("..."),expect(t(2).text()).toBe("11"),expect(t(-2).text()).toBe("12")}),it("moves to the previous set when first ellipsis is clicked",function(){expect(t(1).text()).toBe("..."),n(1),expect(u.currentPage).toBe(5),expect(t(-3)).toHaveClass("active")}),it("moves to the next set when last ellipsis is clicked",function(){expect(t(-2).text()).toBe("..."),n(-2),expect(u.currentPage).toBe(11),expect(t(2)).toHaveClass("active")}),it("should not display page numbers, if max-size is zero",function(){u.maxSize=0,u.$digest(),expect(e()).toBe(2),expect(t(0).text()).toBe("Previous"),expect(t(1).text()).toBe("Next")})}),describe("pagination directive with `boundary-links`",function(){beforeEach(function(){x=c('<uib-pagination boundary-links="true" total-items="total" ng-model="currentPage"></uib-pagination>')(u),u.$digest()}),it("contains num-pages + 4 li elements",function(){expect(e()).toBe(9),expect(t(0).text()).toBe("First"),expect(t(1).text()).toBe("Previous"),expect(t(-2).text()).toBe("Next"),expect(t(-1).text()).toBe("Last")}),it("has first and last li elements visible",function(){expect(t(0).css("display")).not.toBe("none"),expect(t(-1).css("display")).not.toBe("none")}),it('disables the "first" & "previous" link if current page is 1',function(){o(1),expect(t(0)).toHaveClass("disabled"),expect(t(1)).toHaveClass("disabled")}),it('disables the "last" & "next" link if current page is num-pages',function(){o(5),expect(t(-2)).toHaveClass("disabled"),expect(t(-1)).toHaveClass("disabled")}),it('changes currentPage if the "first" link is clicked',function(){n(0),expect(u.currentPage).toBe(1)}),it('changes currentPage if the "last" link is clicked',function(){n(-1),expect(u.currentPage).toBe(5)}),it('does not change the current page on "first" click if already at first page',function(){o(1),n(0),expect(u.currentPage).toBe(1)}),it('does not change the current page on "last" click if already at last page',function(){o(5),n(-1),expect(u.currentPage).toBe(5)}),it('changes "first" & "last" text from attributes',function(){x=c('<uib-pagination boundary-links="true" first-text="<<<" last-text=">>>" total-items="total" ng-model="currentPage"></uib-pagination>')(u),u.$digest(),expect(t(0).text()).toBe("<<<"),expect(t(-1).text()).toBe(">>>")}),it('changes "previous" & "next" text from attributes',function(){x=c('<uib-pagination boundary-links="true" previous-text="<<" next-text=">>" total-items="total" ng-model="currentPage"></uib-pagination>')(u),u.$digest(),expect(t(1).text()).toBe("<<"),expect(t(-2).text()).toBe(">>")}),it('changes "first" & "last" text from interpolated attributes',function(){u.myfirstText="<<<",u.mylastText=">>>",x=c('<uib-pagination boundary-links="true" first-text="{{myfirstText}}" last-text="{{mylastText}}" total-items="total" ng-model="currentPage"></uib-pagination>')(u),u.$digest(),expect(t(0).text()).toBe("<<<"),expect(t(-1).text()).toBe(">>>")}),it('changes "previous" & "next" text from interpolated attributes',function(){u.previousText="<<",u.nextText=">>",x=c('<uib-pagination boundary-links="true" previous-text="{{previousText}}" next-text="{{nextText}}" total-items="total" ng-model="currentPage"></uib-pagination>')(u),u.$digest(),expect(t(1).text()).toBe("<<"),expect(t(-2).text()).toBe(">>")}),it('should blur the "first" link after it has been clicked',function(){p.append(x);var e=a(x,0);e.focus(),expect(e).toHaveFocus(),e.click(),expect(e).not.toHaveFocus(),x.remove()}),it('should blur the "last" link after it has been clicked',function(){p.append(x);var e=a(x,-1);e.focus(),expect(e).toHaveFocus(),e.click(),expect(e).not.toHaveFocus(),x.remove()})}),describe("pagination directive with just number links",function(){beforeEach(function(){x=c('<uib-pagination direction-links="false" total-items="total" ng-model="currentPage"></uib-pagination>')(u),u.$digest()}),it("contains num-pages li elements",function(){expect(e()).toBe(5),expect(t(0).text()).toBe("1"),expect(t(-1).text()).toBe("5")}),it("has the number of the page as text in each page item",function(){for(var e=0;5>e;e++)expect(t(e).text()).toEqual(""+(e+1))}),it("sets the current page to be active",function(){expect(t(2)).toHaveClass("active")}),it('does not disable the "1" link if current page is 1',function(){o(1),expect(t(0)).not.toHaveClass("disabled"),expect(t(0)).toHaveClass("active")}),it('does not disable the "last" link if current page is last page',function(){o(5),expect(t(-1)).not.toHaveClass("disabled"),expect(t(-1)).toHaveClass("active")}),it("changes currentPage if a page link is clicked",function(){n(1),expect(u.currentPage).toBe(2)}),it("changes the number of items when total items changes",function(){u.total=73,u.$digest(),expect(e()).toBe(8),expect(t(0).text()).toBe("1"),expect(t(-1).text()).toBe("8")})}),describe("with just boundary & number links",function(){beforeEach(function(){u.directions=!1,x=c('<uib-pagination boundary-links="true" direction-links="directions" total-items="total" ng-model="currentPage"></uib-pagination>')(u),u.$digest()}),it("contains number of pages + 2 li elements",function(){expect(e()).toBe(7),expect(t(0).text()).toBe("First"),expect(t(1).text()).toBe("1"),expect(t(-2).text()).toBe("5"),expect(t(-1).text()).toBe("Last")}),it('disables the "first" & activates "1" link if current page is 1',function(){o(1),expect(t(0)).toHaveClass("disabled"),expect(t(1)).not.toHaveClass("disabled"),expect(t(1)).toHaveClass("active")}),it('disables the "last" & "next" link if current page is num-pages',function(){o(5),expect(t(-2)).toHaveClass("active"),expect(t(-2)).not.toHaveClass("disabled"),expect(t(-1)).toHaveClass("disabled")})}),describe("`num-pages`",function(){beforeEach(function(){u.numpg=null,x=c('<uib-pagination total-items="total" ng-model="currentPage" num-pages="numpg"></uib-pagination>')(u),u.$digest()}),it("equals to total number of pages",function(){expect(u.numpg).toBe(5)}),it("changes when total number of pages change",function(){u.total=73,u.$digest(),expect(u.numpg).toBe(8)}),it("shows minimun one page if total items are not defined and does not break binding",function(){u.total=void 0,u.$digest(),expect(u.numpg).toBe(1),u.total=73,u.$digest(),expect(u.numpg).toBe(8)})}),describe("setting `paginationConfig`",function(){var n,a;beforeEach(inject(function(e){n=angular.copy(e),a=e})),afterEach(inject(function(e){angular.copy(n,e)})),it("should change paging text",function(){a.boundaryLinks=!0,a.directionLinks=!0,a.firstText="FI",a.previousText="PR",a.nextText="NE",a.lastText="LA",x=c('<uib-pagination total-items="total" ng-model="currentPage"></uib-pagination>')(u),u.$digest(),expect(t(0).text()).toBe("FI"),expect(t(1).text()).toBe("PR"),expect(t(-2).text()).toBe("NE"),expect(t(-1).text()).toBe("LA")}),it("contains number of pages + 2 li elements",function(){a.itemsPerPage=5,x=c('<uib-pagination total-items="total" ng-model="currentPage"></uib-pagination>')(u),u.$digest(),expect(e()).toBe(12)}),it("should take maxSize defaults into account",function(){a.maxSize=2,x=c('<uib-pagination total-items="total" ng-model="currentPage"></uib-pagination>')(u),u.$digest(),expect(e()).toBe(4)}),it("should take forceEllipses defaults into account",function(){a.forceEllipses=!0,x=c('<uib-pagination total-items="total" ng-model="currentPage" max-size="2"></uib-pagination>')(u),u.$digest(),expect(e()).toBe(6)}),it("should take boundaryLinkNumbers defaults into account",function(){a.boundaryLinkNumbers=!0,u.total=88,u.currentPage=5,x=c('<uib-pagination total-items="total" ng-model="currentPage" max-size="3"></uib-pagination>')(u),u.$digest(),expect(e()).toBe(9),expect(i()).toBe("Previous, 1, ..., 4, 5, 6, ..., 9, Next")})}),describe("override configuration from attributes",function(){beforeEach(function(){u.pageLabel=function(e){return"test_"+e},x=c('<uib-pagination boundary-links="true" page-label="pageLabel($page)" first-text="<<" previous-text="<" next-text=">" last-text=">>" total-items="total" ng-model="currentPage"></uib-pagination>')(u),u.$digest()}),it("contains number of pages + 4 li elements",function(){expect(e()).toBe(9)}),it("should change paging text from attribute",function(){expect(t(0).text()).toBe("<<"),expect(t(1).text()).toBe("<"),expect(t(-2).text()).toBe(">"),expect(t(-1).text()).toBe(">>")}),it("has the label of the page as text in each page item",function(){for(var e=1;5>=e;e++)expect(t(e+1).text()).toEqual("test_"+e)})}),describe("disabled with ngDisable",function(){beforeEach(function(){x=c('<uib-pagination total-items="total" ng-model="currentPage" ng-disabled="disabled"></uib-pagination>')(u),u.currentPage=3,u.$digest()}),it("should not respond to clicking",function(){s(!0),n(2),expect(u.currentPage).toBe(3),s(!1),n(2),expect(u.currentPage).toBe(2)}),it("should change the class of all buttons except selected one",function(){s(!1),expect(t(3).hasClass("active")).toBe(!0),expect(t(4).hasClass("active")).toBe(!1),s(!0),expect(t(3).hasClass("disabled")).toBe(!1),expect(t(4).hasClass("disabled")).toBe(!0)})})}),describe("pagination directive",function(){var e,t,i;beforeEach(module("ui.bootstrap.pagination")),beforeEach(module("uib/template/pagination/pagination.html")),beforeEach(inject(function(i,n){e=i,t=n})),it("should retain the model value when total-items starts as undefined",function(){t.currentPage=5,t.total=void 0,i=e('<uib-pagination total-items="total" ng-model="currentPage"></uib-pagination>')(t),t.$digest(),expect(t.currentPage).toBe(5),t.total=100,t.$digest(),expect(t.currentPage).toBe(5)})});