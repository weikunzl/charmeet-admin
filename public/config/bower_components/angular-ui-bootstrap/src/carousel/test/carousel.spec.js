describe("carousel",function(){beforeEach(module("ui.bootstrap.carousel",function(e,t){function i(i){t.value(i+"Directive",[]),e.directive(i,function(){return function(e,t,n){t.on(i,function(){e.$apply(n[i])})}})}angular.forEach(["ngSwipeLeft","ngSwipeRight"],i)})),beforeEach(module("ngAnimateMock")),beforeEach(module("uib/template/carousel/carousel.html","uib/template/carousel/slide.html"));var e,t,i,n,l,o,s;beforeEach(inject(function(a,c,d,r,u,p,h){e=a,t=c,i=d,n=r,l=u,o=p,s=h})),describe("basics",function(){function i(e){for(var t=0;t<c.slides.length;t++)t===e?expect(c.active).toBe(c.slides[t].index):expect(c.active).not.toBe(c.slides[t].index)}var a,c;beforeEach(function(){c=e.$new(),c.slides=[{content:"one",index:0},{content:"two",index:1},{content:"three",index:2}],a=t('<uib-carousel active="active" interval="interval" no-transition="true" no-pause="nopause"><uib-slide ng-repeat="slide in slides track by slide.index" index="slide.index">{{slide.content}}</uib-slide></uib-carousel>')(c),c.interval=5e3,c.nopause=void 0,c.$apply()}),it("should allow overriding of the carousel template",function(){l.put("foo/bar.html","<div>foo</div>"),a=t('<uib-carousel template-url="foo/bar.html"></uib-carousel>')(c),e.$digest(),expect(a.html()).toBe("foo")}),it("should allow overriding of the slide template",function(){l.put("foo/bar.html",'<div class="slide">bar</div>'),a=t('<uib-carousel interval="interval" no-transition="true" no-pause="nopause"><uib-slide template-url="foo/bar.html"></uib-slide></uib-carousel>')(c),e.$digest();var i=a.find(".slide");expect(i.html()).toBe("bar")}),it("should be able to select a slide via model changes",function(){i(0),c.$apply("active=1"),i(1)}),it("should create clickable prev nav button",function(){var e=a.find("a.left"),t=a.find("a.right");expect(e.length).toBe(1),expect(t.length).toBe(1)}),it("should display clickable slide indicators",function(){var e=a.find("ol.carousel-indicators > li");expect(e.length).toBe(3)}),it("should stop cycling slides forward when noWrap is truthy",function(){a=t('<uib-carousel active="active" interval="interval" no-wrap="noWrap"><uib-slide ng-repeat="slide in slides track by slide.index" index="slide.index">{{slide.content}}</uib-slide></uib-carousel>')(c),c.noWrap=!0,c.$apply();var e=a.isolateScope();spyOn(e,"pause"),c.active=e.slides.length-1,c.$apply(),i(e.slides.length-1),e.next(),i(e.slides.length-1),expect(e.pause).toHaveBeenCalled()}),it("should stop cycling slides backward when noWrap is truthy",function(){a=t('<uib-carousel active="active" interval="interval" no-wrap="noWrap"><uib-slide ng-repeat="slide in slides track by slide.index" index="slide.index">{{slide.content}}</uib-slide></uib-carousel>')(c),c.noWrap=!0,c.$apply();var e=a.isolateScope();spyOn(e,"pause"),i(0),e.prev(),i(0),expect(e.pause).toHaveBeenCalled()}),it("should hide navigation when only one slide",function(){c.slides=[{active:!1,content:"one"}],c.$apply(),a=t('<uib-carousel active="active" interval="interval" no-transition="true"><uib-slide ng-repeat="slide in slides" index="$index">{{slide.content}}</uib-slide></uib-carousel>')(c);var e=a.find("ol.carousel-indicators > li");expect(e.length).toBe(0);var i=a.find("a.right");expect(i.length).toBe(0);var n=a.find("a.left");expect(n.length).toBe(0)}),it("should disable prev button when slide index is 0 and noWrap is truthy",function(){c.$apply();var e=a.isolateScope();e.noWrap=function(){return!0},e.isPrevDisabled(),c.$apply();var t=a.find("a.left");expect(t.hasClass("disabled")).toBe(!0)}),it("should disable next button when last slide is active and noWrap is truthy",function(){c.slides=[{content:"one",index:0},{content:"two",index:1}],c.$apply();var e=a.isolateScope();e.noWrap=function(){return!0},e.next(),e.isNextDisabled(),c.$apply();var t=a.find("a.right");expect(t.hasClass("disabled")).toBe(!0)}),it("should show navigation when there are 3 slides",function(){var e=a.find("ol.carousel-indicators > li");expect(e.length).not.toBe(0);var t=a.find("a.right");expect(t.length).not.toBe(0);var i=a.find("a.left");expect(i.length).not.toBe(0)}),it("should go to next when clicking next button",function(){var e=a.find("a.right");i(0),e.click(),i(1),e.click(),i(2),e.click(),i(0)}),it("should go to prev when clicking prev button",function(){var e=a.find("a.left");i(0),e.click(),i(2),e.click(),i(1),e.click(),i(0)}),describe("swiping",function(){it("should go next on swipeLeft",function(){i(0),a.triggerHandler("ngSwipeLeft"),i(1)}),it("should go prev on swipeRight",function(){i(0),a.triggerHandler("ngSwipeRight"),i(2)})}),it("should select a slide when clicking on slide indicators",function(){var e=a.find("ol.carousel-indicators > li");e.eq(1).click(),i(1)}),it("shouldnt go forward if interval is NaN or negative or has no slides",function(){i(0);var e=c.interval;c.$apply("interval = -1"),n.flush(e),i(0),c.$apply("interval = 1000"),n.flush(1e3),i(1),c.$apply("interval = false"),n.flush(1e3),i(1),c.$apply("interval = 1000"),n.flush(1e3),i(2),c.$apply("slides = []"),n.flush(1e3),i(2)}),it("should bind the content to slides",function(){var e=a.find("div.item");expect(e.length).toBe(3),expect(e.eq(0).text()).toBe("one"),expect(e.eq(1).text()).toBe("two"),expect(e.eq(2).text()).toBe("three"),c.$apply(function(){c.slides[0].content="what",c.slides[1].content="no",c.slides[2].content="maybe"}),expect(e.eq(0).text()).toBe("what"),expect(e.eq(1).text()).toBe("no"),expect(e.eq(2).text()).toBe("maybe")}),it("should be playing by default and cycle through slides",function(){i(0),n.flush(c.interval),i(1),n.flush(c.interval),i(2),n.flush(c.interval),i(0)}),it("should pause and play on mouseover",function(){i(0),n.flush(c.interval),i(1),a.trigger("mouseenter"),i(1),n.flush(c.interval),i(1),a.trigger("mouseleave"),n.flush(c.interval),i(2)}),it("should not pause on mouseover if noPause",function(){c.$apply("nopause = true"),i(0),a.trigger("mouseenter"),n.flush(c.interval),i(1),a.trigger("mouseleave"),n.flush(c.interval),i(2)}),it("should remove slide from dom and change active slide",function(){c.$apply("active = 2"),i(2),c.$apply("slides.splice(2,1)"),o.flush(0),expect(a.find("div.item").length).toBe(2),i(1),n.flush(c.interval),i(0),c.$apply("slides.splice(1,1)"),o.flush(0),expect(a.find("div.item").length).toBe(1),i(0)}),it("should change dom when you reassign ng-repeat slides array",function(){c.slides=[{content:"new1",index:4},{content:"new2",index:5},{content:"new3",index:6}],c.$apply();var e=a.find("div.item");expect(e.length).toBe(3),expect(e.eq(0).text()).toBe("new1"),expect(e.eq(1).text()).toBe("new2"),expect(e.eq(2).text()).toBe("new3")}),it("should not change if next is clicked while transitioning",function(){var e=a.children().scope(),t=a.find("a.right");i(0),e.$currentTransition=!0,t.click(),i(0),e.$currentTransition=null,t.click(),i(1)}),it("should buffer the slides if transition is clicked and only transition to the last requested",function(){var e=a.children().scope();i(0),e.$currentTransition=null,e.select(e.slides[1]),s.flush(),i(1),e.$currentTransition=!0,e.select(e.slides[2]),c.$apply(),i(1),e.select(e.slides[0]),c.$apply(),i(1),e.$currentTransition=null,n.flush(c.interval),s.flush(),i(2),n.flush(c.interval),s.flush(),i(0)}),it("issue 1414 - should not continue running timers after scope is destroyed",function(){i(0),n.flush(c.interval),i(1),n.flush(c.interval),i(2),n.flush(c.interval),i(0),spyOn(n,"cancel").and.callThrough(),c.$destroy(),expect(n.cancel).toHaveBeenCalled()}),it("issue 4390 - should reset the currentTransition if there are no slides",function(){var e=a.children().scope();a.find("a.right");c.slides=[{content:"new1",index:1},{content:"new2",index:2},{content:"new3",index:3}],c.$apply(),i(0),e.$currentTransition=!0,c.slides=[],c.$apply(),expect(e.$currentTransition).toBe(null)})}),describe("slide order",function(){function i(e){for(var t=0;t<l.slides.length;t++)t===e?expect(l.active).toBe(l.slides[t].id):expect(l.active).not.toBe(l.slides[t].id)}var n,l;beforeEach(function(){l=e.$new(),l.slides=[{content:"one",id:3},{content:"two",id:1},{content:"three",id:2}],n=t('<uib-carousel active="active" interval="interval" no-transition="true" no-pause="nopause"><uib-slide ng-repeat="slide in slides | orderBy: \'id\' track by slide.id" index="slide.id">{{slide.content}}</uib-slide></uib-carousel>')(l),l.$apply()}),it("should change dom when the order of the slides changes",function(){l.slides[0].id=3,l.slides[1].id=2,l.slides[2].id=1,l.$apply();var e=n.find("div.item");expect(e.length).toBe(3),expect(e.eq(0).text()).toBe("three"),expect(e.eq(1).text()).toBe("two"),expect(e.eq(2).text()).toBe("one")}),it("should select next after order change",function(){i(1);var e=n.find("a.right");e.click(),i(2)}),it("should select prev after order change",function(){i(1);var e=n.find("a.left");e.click(),i(0)}),it("should add slide in the specified position",function(){i(1),l.slides[2].id=4,l.slides.push({content:"four",id:5}),l.$apply();var e=n.find("div.item");expect(e.length).toBe(4),expect(e.eq(0).text()).toBe("two"),expect(e.eq(1).text()).toBe("one"),expect(e.eq(2).text()).toBe("three"),expect(e.eq(3).text()).toBe("four")}),it("should remove slide after order change",function(){i(1),l.slides.splice(1,1),l.$apply();var e=n.find("div.item");expect(e.length).toBe(2),expect(e.eq(0).text()).toBe("three"),expect(e.eq(1).text()).toBe("one")})}),describe("controller",function(){var l,s,a=[{content:1,index:0},{content:2,index:1},{content:3,index:2},{content:4,index:3}];beforeEach(function(){l=e.$new(),l.noWrap=angular.noop,s=i("UibCarouselController",{$scope:l,$element:angular.element("<div></div>")});for(var t=0;t<a.length;t++)s.addSlide(a[t])}),it("should set first slide to active = true and the rest to false",function(){angular.forEach(s.slides,function(e,t){0!==t?expect(e.slide.active).not.toBe(!0):expect(e.slide.active).toBe(!0)})}),it("should add a new slide and not change the active slide",function(){var e={active:!1,index:4};expect(s.slides.length).toBe(4),s.addSlide(e),expect(s.slides.length).toBe(5),expect(s.slides[4].slide.active).toBe(!1),expect(s.slides[0].slide.active).toBe(!0)}),it("should remove slide and change active slide if needed",function(){expect(s.slides.length).toBe(4),s.removeSlide(s.slides[0].slide),o.flush(0),expect(s.slides.length).toBe(3),expect(l.active).toBe(1),s.select(s.slides[2]),s.removeSlide(s.slides[2].slide),o.flush(0),expect(s.slides.length).toBe(2),expect(l.active).toBe(2),s.removeSlide(s.slides[0].slide),o.flush(0),expect(s.slides.length).toBe(1),expect(l.active).toBe(1)}),it("issue 1414 - should not continue running timers after scope is destroyed",function(){spyOn(l,"next"),l.interval=2e3,l.$digest(),n.flush(l.interval),expect(l.next.calls.count()).toBe(1),l.$destroy(),n.flush(l.interval),expect(l.next.calls.count()).toBe(1)}),it("should be exposed in the template",inject(function(i){i.put("uib/template/carousel/carousel.html","<div>{{carousel.text}}</div>");var n=e.$new(),l=t('<uib-carousel interval="bar" no-transition="false" no-pause="true"></uib-carousel>')(n);e.$digest();var o=l.controller("uibCarousel");expect(o).toBeDefined(),o.text="foo",e.$digest(),expect(l.html()).toBe("foo")}))}),it("should expose a custom model in the carousel slide",function(){var i=e.$new();i.slides=[{active:!1,content:"one"},{active:!1,content:"two"},{active:!1,content:"three"}];var n=t('<uib-carousel active="active" interval="interval" no-transition="true" no-pause="nopause"><uib-slide ng-repeat="slide in slides" index="$index" actual="slide">{{slide.content}}</uib-slide></uib-carousel>')(i);e.$digest();var l=n.controller("uibCarousel");expect(angular.equals(l.slides.map(function(e){return e.slide.actual}),i.slides)).toBe(!0)})});